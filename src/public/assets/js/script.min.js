localStorage.getItem("key")||(window.location.href="/login");const webSocketServerLocation=`${"https:"===window.location.protocol?"wss":"ws"}://${window.location.host}`;let config=void 0,myAccount=void 0,clientIsAdmin=!1;function containsClassName(e,t){return e.classList.contains(t)}function toggleClassName(e,t){e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)}function addClassName(e,t){e.classList.add(t)}function removeClassName(e,t){e.classList.remove(t)}function getFullTime(e){const t=new Date(parseInt(e));return`${("0"+t.getDate()).slice(-2)}/${("0"+(t.getMonth()+1)).slice(-2)}/${t.getFullYear()} ${("0"+t.getHours()).slice(-2)}:${("0"+t.getMinutes()).slice(-2)}:${("0"+t.getSeconds()).slice(-2)}`}const pageLoader=document.querySelector("#page-loader"),pageLoaderSpinner=document.querySelectorAll(".spinner")[0];function initSystem(){fetch("account/data").then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:(config=e.config,myAccount=e.account,main(e),setPageLoader(1))})}function setPageLoader(e){if(pageLoader.style.opacity=1,pageLoaderSpinner.style.opacity=1,0===e)addClassName(pageLoader,"active");else{setPageLoaderStatus("finish");const e=setInterval(()=>{pageLoader.style.opacity>0?(pageLoader.style.opacity-=.1,pageLoaderSpinner.style.opacity-=.1):(clearInterval(e),removeClassName(pageLoader,"active"))},30)}}const pageLoaderStatusText=document.querySelector("#page-loader-status");function setPageLoaderStatus(e){pageLoaderStatusText.innerText=e}function main(e){if(getCookie("permissions_level")>0?clientIsAdmin=!0:navItemServerSettings.style.display="none",getCookie("user_content_serversettings")||setCookie("user_content_serversettings","0",7),localStorage.setItem("symbols",myAccount.symbols),initCreatePassword(),initPasswordSearch(),initModalAccountCreate(),initModalAccountEdit(),initAccountSearch(),updateServerStats(e.stats),initModalMyAccountEdit(),initMyAccountSettings(),initMyAccountSessions(),initMyAccountPasswordTrash(),initModalPasswordsImport(),initModalPasswordsExport(),getCookie("user_content")?changeContentTo(parseInt(getCookie("user_content"))):changeContentTo(0),updateUser(myAccount),Password.clearPasswords(),e.passwords&&0!==e.passwords.length){showNoPasswordsMessage(!1);try{const t=getKey();for(let s of e.passwords){const e={id:s.id,name:CryptoJS.AES.decrypt(s.name,t).toString(CryptoJS.enc.Utf8),password:CryptoJS.AES.decrypt(s.password,t).toString(CryptoJS.enc.Utf8),histories:[],platform:void 0===s.platform?"":CryptoJS.AES.decrypt(s.platform,t).toString(CryptoJS.enc.Utf8),url:void 0===s.url?"":CryptoJS.AES.decrypt(s.url,t).toString(CryptoJS.enc.Utf8),username:void 0===s.username?"":CryptoJS.AES.decrypt(s.username,t).toString(CryptoJS.enc.Utf8),email:void 0===s.email?"":CryptoJS.AES.decrypt(s.email,t).toString(CryptoJS.enc.Utf8),description:void 0===s.description?"":CryptoJS.AES.decrypt(s.description,t).toString(CryptoJS.enc.Utf8),createdAt:CryptoJS.AES.decrypt(s.createdAt,t).toString(CryptoJS.enc.Utf8),modifiedAt:void 0===s.modifiedAt?void 0:CryptoJS.AES.decrypt(s.modifiedAt,t).toString(CryptoJS.enc.Utf8)};for(const o of s.histories){const s={id:o.id,password:CryptoJS.AES.decrypt(o.password,t).toString(CryptoJS.enc.Utf8),deletedAt:CryptoJS.AES.decrypt(o.deletedAt,t).toString(CryptoJS.enc.Utf8)};e.histories.push(s)}new Password(e)}}catch(e){console.error("key invalid",e),handleLogOut("/login")}Password.registerClickEvents()}else showNoPasswordsMessage(!0),0!==passwordsMap.size&&Password.clearPasswords();initModalPasswordEdit(),initAccounts(e.accounts)}function initAccounts(e){if(0===myAccount.permissionsLevel)return;accountSearch.clear(),modalAccountCreate.close(),modalAccountEdit.close();const t=serverSettingsTabContentAccounts.querySelectorAll(".collapsible"),s=serverSettingsTabContentAccounts.querySelectorAll(".collapsible-body");for(let e of t)e.remove();for(let e of s)e.remove();if(0!==e.length){for(let t of e)modalAccountLog.setDates(t.dates),new ServerSettingsAccount(t).build();ServerSettingsAccount.registerClickEvents()}else sendPopup("error",config.messages.noAccounts)}function initMyAccountSettings(){setAccount("passwords",myAccount.passwords),setAccount("id",myAccount.id),setAccount("createdAt",getFullTime(myAccount.createdAt),config.colors.createdAt),contentAccountSettings.querySelector(".fa-upload").onclick=(()=>modalPasswordsImport.build()),contentAccountSettings.querySelector(".fa-download").onclick=(()=>modalPasswordsExport.build()),contentAccountSettings.querySelector(".fa-desktop").onclick=(()=>{myAccount.dates&&0!==myAccount.dates.length?modalAccountLog.build(myAccount.id,myAccount.dates):sendPopup("error",config.messages.noAccountLogs)}),contentAccountSettings.querySelector(".fa-cog").onclick=(()=>modalMyAccountEdit.build(myAccount.id))}function initMyAccountSessions(){contentAccountSettings.querySelector("#sessions").innerHTML="";for(const e of myAccount.sessions)addSession(e)}function addSession(e){const t=createElement("div",{id:`session-${e.id}`});contentAccountSettings.querySelector("#sessions").appendChild(t);const s=createElement("div",{class:"space-between"});t.appendChild(s);const o=createElement("h4",{},`${e.ip} - ${e.browser} on ${e.platform}`);s.appendChild(o);const r=createElement("i",{class:"fa fa-sign-out-alt","aria-hidden":!0});s.appendChild(r);const a=createElement("p",{},"current"===e.lastAccessed?`<span style="color: ${config.colors.session.current}">Your current session</span>`:`Last accessed on <span style="color: ${config.colors.session.lastAccessed}">${getFullTime(e.lastAccessed)}</span>`,!0);t.appendChild(a),r.onclick=(()=>{fetch("/session/revoke",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`id=${e.id}`}).then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:sendPopup("success","Session revoked")})})}function updateSession(e){const t=contentAccountSettings.querySelector(`#session-${e.id}`);t?(t.querySelector("h4").innerHTML=`${e.ip} - ${e.browser} on ${e.platform}`,t.querySelector("p").innerHTML=`Last accessed on <span style="color: ${config.colors.session.lastAccessed}">${getFullTime(e.lastAccessed)}</span>`):addSession(e)}function removeSession(e){contentAccountSettings.querySelector(`#session-${e}`).remove()}function initMyAccountPasswordTrash(){const e=contentAccountSettings.querySelector("#passwordTrash");contentAccountSettings.querySelector("#card-passwordtrash");if(handleShowPasswordTrash(),0!==myAccount.passwordTrash.length){e.innerHTML="";for(const e of myAccount.passwordTrash)addPasswordToTrash(e)}}function handleShowPasswordTrash(){contentAccountSettings.querySelector("#card-passwordtrash").style.display=0===myAccount.passwordTrash.length?"none":"block"}function addPasswordToTrash(e){const t=getKey(),s={name:CryptoJS.AES.decrypt(e.name,t).toString(CryptoJS.enc.Utf8),deletedAt:CryptoJS.AES.decrypt(e.deletedAt,t).toString(CryptoJS.enc.Utf8)},o=contentAccountSettings.querySelector("#passwordTrash"),r=createElement("div",{id:`password-trash-${e.id}`});o.appendChild(r);const a=createElement("div",{class:"space-between"});r.appendChild(a),a.appendChild(createElement("h4",{},`${s.name} <span style="color: #d1d1d1">#</span>${e.id}`,!0));const i=createElement("div");a.appendChild(i);const n=createElement("i",{class:"fa fa-redo","aria-hidden":!0}),c=createElement("i",{class:"fa fa-trash","aria-hidden":!0});i.appendChild(n),i.appendChild(c);const l=createElement("p",{},"From: ");r.appendChild(l),l.appendChild(createElement("span",{style:{color:"#c0392b"}},getFullTime(s.deletedAt))),n.onclick=(()=>{fetch("/pwtrash/restore",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`id=${e.id}`}).then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:sendPopup("success","Password revoked")})}),c.onclick=(()=>{fetch("/pwtrash/delete",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`id=${e.id}`}).then(e=>e.json()).then(t=>{t.logout?window.location.href=t.logout:sendPopup("success",`Password <span style="color: #d1d1d1">#</span><b>${e.id}</b> was deleted from trash`)})})}function deletePasswordFromTrash(e){const t=document.querySelector(`#password-trash-${e}`);t&&t.remove(),myAccount.passwordTrash=myAccount.passwordTrash.filter(t=>t.id!==e)}function setAccount(e,t,s){const o=contentAccountSettings.querySelector(`#account-${e.toLowerCase()}`);o.innerHTML=null===t?"-/-":"permissionsLevel"===e?getRankName(t):t,s&&(o.style.color=s),myAccount[e]=t}function showNoPasswordsMessage(e){const t=contentPasswords.querySelector("#nopasswords");t.innerHTML=config.messages.noPasswords,e?addClassName(t,"active"):removeClassName(t,"active")}class ModalPasswordsImport{constructor(e,t,s,o,r,a,i){this.modal=e,this.headerIconClose=t,this.form=s,this.importContainer=o,this.passwordContainer=r,this.previewContainer=a,this.table=i,this.passwords=[],this.register()}open(){addClassName(this.modal,"active")}close(){removeClassName(this.modal,"active")}getModal(){return this.modal}register(){this.headerIconClose.onclick=(()=>this.close()),this.init(),this.form.type.onchange=(()=>{"decryptedCsv"===this.form.type.value?(removeClassName(this.passwordContainer,"active"),this.form.password.removeAttribute("required")):(addClassName(this.passwordContainer,"active"),this.form.password.setAttribute("required",""))}),this.form.buttonImport.onclick=(()=>{this.form.onsubmit=(e=>{if(e.preventDefault(),containsClassName(this.importContainer,"active")){const e=createElement("input",{type:"file"});e.click(),e.onchange=(()=>{const t=e.files[0];this.form.type.value.endsWith("Csv")?"text/csv"===t.type?(removeClassName(this.importContainer,"active"),addClassName(this.previewContainer,"active"),"encryptedCsv"===this.form.type.value?this.importCsvEncrypted(t):this.importCsvDecrypted(t)):sendPopup("error","Please select file with csv type"):this.form.type.value.endsWith("Json")?"application/json"===t.type?(removeClassName(this.importContainer,"active"),addClassName(this.previewContainer,"active"),this.importJsonEncrypted(t)):sendPopup("error","Please select file with json type"):sendPopup("error","File type invalid")})}else{const e=[],t=getKey();for(const s of this.passwords){if(!isPasswordNameAvailable(s.name)){let e=!1,t=0;for(;!e;)t++,isPasswordNameAvailable(`${s.name}${t}`)&&(e=!0,s.name=`${s.name}${t}`)}const o={id:!0===isPasswordIdAvailable(s.id)?s.id:generateUniquePasswordId(),name:CryptoJS.AES.encrypt(s.name,t).toString(),password:CryptoJS.AES.encrypt(s.password,t).toString(),histories:[],platform:void 0===s.platform?void 0:CryptoJS.AES.encrypt(s.platform,t).toString(),url:void 0===s.url?void 0:CryptoJS.AES.encrypt(s.url,t).toString(),username:void 0===s.username?void 0:CryptoJS.AES.encrypt(s.username,t).toString(),email:void 0===s.email?void 0:CryptoJS.AES.encrypt(s.email,t).toString(),description:void 0===s.description?void 0:CryptoJS.AES.encrypt(s.description,t).toString(),createdAt:CryptoJS.AES.encrypt(s.createdAt,t).toString(),modifiedAt:void 0===s.modifiedAt?void 0:CryptoJS.AES.encrypt(s.modifiedAt,t).toString()};for(const e of s.histories){const s={id:e.id,password:CryptoJS.AES.encrypt(e.password,t).toString(),deletedAt:CryptoJS.AES.encrypt(e.deletedAt,t).toString()};o.histories.push(s)}e.push(o)}fetch("password/create",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({type:1,passwords:e})}).then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:sendPopup("success",config.messages.password.imported)}).catch(e=>console.error(e))}})})}init(){this.close()}reset(){this.passwords=[],this.form.type.value="decryptedCsv",removeClassName(this.passwordContainer,"active"),this.form.password.removeAttribute("required"),this.form.password.value="",this.form.password.style.boxShadow="none",this.table.innerHTML="<tr>\n                              <th>Id</th>\n                              <th>Name</th>\n                              <th>Password</th>\n                              <th>Histories</th>\n                              <th>Platform</th>\n                              <th>Url</th>\n                              <th>Username</th>\n                              <th>Email</th>\n                              <th>Description</th>\n                              <th>Created at</th>\n                              <th>Modified at</th>\n                            </tr>"}build(){this.reset(),addClassName(this.importContainer,"active"),removeClassName(this.previewContainer,"active"),removeClassName(this.passwordContainer,"active"),this.open()}importCsvEncrypted(e){let t=new FileReader;t.readAsBinaryString(e),t.onload=(e=>{const t=e.target.result.split("\n");t.shift();const s=this.form.password.value;try{for(const e of t){const t=e.split(",");if(""!==t[0]){const e={id:CryptoJS.AES.decrypt(t[0],s).toString(CryptoJS.enc.Utf8),name:CryptoJS.AES.decrypt(t[1],s).toString(CryptoJS.enc.Utf8),password:CryptoJS.AES.decrypt(t[2],s).toString(CryptoJS.enc.Utf8),histories:JSON.parse(CryptoJS.AES.decrypt(t[3],s).toString(CryptoJS.enc.Utf8)),platform:CryptoJS.AES.decrypt(t[4],s).toString(CryptoJS.enc.Utf8),url:CryptoJS.AES.decrypt(t[5],s).toString(CryptoJS.enc.Utf8),username:CryptoJS.AES.decrypt(t[6],s).toString(CryptoJS.enc.Utf8),email:CryptoJS.AES.decrypt(t[7],s).toString(CryptoJS.enc.Utf8),description:CryptoJS.AES.decrypt(t[8],s).toString(CryptoJS.enc.Utf8),createdAt:CryptoJS.AES.decrypt(t[9],s).toString(CryptoJS.enc.Utf8),modifiedAt:CryptoJS.AES.decrypt(t[10],s).toString(CryptoJS.enc.Utf8)};this.passwords.push({id:e.id,name:e.name,password:e.password,histories:e.histories,platform:""===e.platform?void 0:e.platform,url:""===e.url?void 0:e.url,username:""===e.username?void 0:e.username,email:""===e.email?void 0:e.email,description:""===e.description?void 0:e.description,createdAt:""===e.createdAt?void 0:e.createdAt,modifiedAt:""===e.modifiedAt?void 0:e.modifiedAt});const o=document.createElement("tr");this.table.appendChild(o);for(const t in e)o.appendChild(createElement("td",{},"createdAt"===t||"modifiedAt"===t?""===e[t]?"":getFullTime(e[t]):e[t]))}}}catch(e){sendPopup("error","Password is not correct"),this.close()}})}importCsvDecrypted(e){let t=new FileReader;t.readAsBinaryString(e),t.onload=(e=>{const t=e.target.result.split("\n");t.shift();try{for(const e of t)if(""!=e){const t=s(e),o={id:t[0],name:'""'===t[1]?void 0:t[1],password:'""'===t[2]?void 0:t[2],histories:void 0===t[3]?[]:JSON.parse(t[3]),platform:'""'===t[4]?void 0:t[4],url:'""'===t[5]?void 0:t[5],username:'""'===t[6]?void 0:t[6],email:'""'===t[7]?void 0:t[7],description:'""'===t[8]?void 0:t[8].replace(/%nl%/g,"\n"),createdAt:'""'===t[9]?void 0:t[9],modifiedAt:'""'===t[10]?void 0:t[10]};this.passwords.push(o);const r=document.createElement("tr");this.table.appendChild(r);for(let e=0;e<t.length;e++)r.appendChild(createElement("td",{},e>8?""===t[e]?"":getFullTime(t[e]):t[e]))}}catch(e){this.close(),sendPopup("error","Error")}function s(e){let t=[""],s=0,o="",r=!0;for(let a in e)'"'===(a=e[a])?(r=!r,'"'===o?(t[s]+='"',a="-"):""===o&&(a="-")):r&&","===a?a=t[++s]="":t[s]+=a,o=a;return t}})}importJsonEncrypted(e){let t=new FileReader;t.readAsBinaryString(e),t.onload=(e=>{try{const t=JSON.parse(e.target.result),s=this.form.password.value;for(const e of t){const t=document.createElement("tr");this.table.appendChild(t);const o={id:e.id,name:CryptoJS.AES.decrypt(e.name,s).toString(CryptoJS.enc.Utf8),password:void 0===e.password?void 0:CryptoJS.AES.decrypt(e.password,s).toString(CryptoJS.enc.Utf8),histories:[],platform:void 0===e.platform?void 0:CryptoJS.AES.decrypt(e.platform,s).toString(CryptoJS.enc.Utf8),url:void 0===e.url?void 0:CryptoJS.AES.decrypt(e.url,s).toString(CryptoJS.enc.Utf8),username:void 0===e.username?void 0:CryptoJS.AES.decrypt(e.username,s).toString(CryptoJS.enc.Utf8),email:void 0===e.email?void 0:CryptoJS.AES.decrypt(e.email,s).toString(CryptoJS.enc.Utf8),description:void 0===e.description?void 0:CryptoJS.AES.decrypt(e.description,s).toString(CryptoJS.enc.Utf8),createdAt:CryptoJS.AES.decrypt(e.createdAt,s).toString(CryptoJS.enc.Utf8),modifiedAt:void 0===e.modifiedAt?void 0:CryptoJS.AES.decrypt(e.modifiedAt,s).toString(CryptoJS.enc.Utf8)};for(const t of e.histories)o.histories.push({id:t.id,password:CryptoJS.AES.decrypt(t.password,s).toString(CryptoJS.enc.Utf8),deletedAt:CryptoJS.AES.decrypt(t.deletedAt,s).toString(CryptoJS.enc.Utf8)});this.passwords.push(o);for(const e in o)t.appendChild(createElement("td",{},"createdAt"===e||"modifiedAt"===e?void 0===o[e]?"":getFullTime(o[e]):o[e]))}}catch(e){sendPopup("error","Password is not correct"),this.close()}})}}let modalPasswordsImport=void 0;function initModalPasswordsImport(){modalPasswordsImport?modalPasswordsImport.init():modalPasswordsImport=new ModalPasswordsImport(contentAccountSettings.querySelector("#modal-passwords-import"),contentAccountSettings.querySelector("#modal-passwords-import .modal-header #icon-close"),contentAccountSettings.querySelector("#modal-passwords-import form"),contentAccountSettings.querySelector("#modal-passwords-import #import-container"),contentAccountSettings.querySelector("#modal-passwords-import #password-container"),contentAccountSettings.querySelector("#modal-passwords-import #preview-container"),contentAccountSettings.querySelector("#modal-passwords-import table"))}class ModalPasswordsExport{constructor(e,t,s,o,r,a){this.modal=e,this.headerIconClose=t,this.form=s,this.passwordContainer=o,this.min=r,this.max=a,this.register()}open(){addClassName(this.modal,"active")}close(){removeClassName(this.modal,"active")}getModal(){return this.modal}register(){this.headerIconClose.onclick=(()=>this.close()),this.init(),this.form.type.onchange=(()=>{"encrypted"===this.form.type.value?(addClassName(this.passwordContainer,"active"),this.form.password.setAttribute("required","")):(removeClassName(this.passwordContainer,"active"),this.form.password.removeAttribute("required"))}),this.form.buttonExport.onclick=(()=>{this.form.onsubmit=(e=>{switch(e.preventDefault(),this.form.type.value){case"decrypted":this.exportCsvDecrypted();break;case"encrypted":this.exportCsvEncrypted();break;case"html":this.exportHtml();break;default:throw new Error("form type undefined")}})})}init(){this.close(),this.form.password.setAttribute("minlength",this.min),this.form.password.setAttribute("maxlength",this.max),checkInputValidation(this.form.password,this.min,this.max)}reset(){this.form.type.value="decrypted",removeClassName(this.passwordContainer,"active"),this.form.password.removeAttribute("required"),this.form.password.value="",this.form.password.style.boxShadow="none"}build(){this.reset(),0===passwordsMap.size?sendPopup("error",config.messages.noPasswords):this.open()}exportCsvDecrypted(){let e=[];passwordsMap.forEach(t=>e.push(t));let t=`"${["Id","Name","Password","Histories","Platform","Url","Username","Email","Description","createdAt","lastModfied"].join('","')}"\n`;e.forEach(e=>{let s=[];for(const t in e)e.hasOwnProperty(t)&&("histories"===t?s.push(JSON.stringify(e[t])):s.push(void 0===e[t]?"":"description"===t?e[t].replace(/\n/g,"%nl%"):e[t]));t+=function(e){for(let t in e)e[t]=e[t].replace(/"/g,'""');return'"'+e.join('","')+'"'}(s)+"\n"});let s=new Blob([t],{type:"text/csv"});createElement("a",{href:URL.createObjectURL(s),target:"_blank",download:`passwords_${getDate("-")}.csv`}).click(),this.close()}exportCsvEncrypted(){if(this.form.password.value.length<this.min||this.form.password.value.length>this.max)return void sendPopup("error","Error");let e=[];passwordsMap.forEach(t=>e.push(t));let t=`${["Id","Name","Password","Histories","Platform","Url","Username","Email","Description","createdAt","modifiedAt"].join(",")}\n`;e.forEach(e=>{let s=[];for(const t in e)e.hasOwnProperty(t)&&("histories"===t?s.push(CryptoJS.AES.encrypt(JSON.stringify(e[t]),this.form.password.value)):s.push(CryptoJS.AES.encrypt(e[t],this.form.password.value)));t+=`${s.join(",")}\n`});let s=new Blob([t],{type:"text/csv"});createElement("a",{href:URL.createObjectURL(s),target:"_blank",download:`passwords_${getDate("-")}.csv`}).click(),this.close()}exportHtml(){fetch("/server/template?type=export").then(e=>e.json()).then(e=>{e&&e.content||sendPopup("error","Error");let t="",s="";const o=[];for(const e of passwordsMap){t+="<tr>";for(const s in e[1])if("histories"===s)o.push(e[1][s]);else{t+="<td>";const o=e[1][s];t+="url"===s?`<a href="${o.startsWith("https://")||o.startsWith("http://")?o:`https://${o}`}" target="_blank">${o}</a>`:"createdAt"===s||"modifiedAt"===s?void 0===o||""===o?"":getFullTime(o):void 0===o?"":o,t+="</td>"}t+="</tr>"}for(const e of o)for(const t of e)s+=`<tr>\n                              <td>${t.id}</td>\n                              <td>${t.password}</td>\n                              <td>${getFullTime(t.deletedAt)}</td>\n                            </tr>`;let r=e.content.split("%list%").join(t);r=""!=s?r.split("%histories%").join(`<h1>Histories</h1>\n          <table>\n            <tr>\n              <th style="min-width: 150px; width: 10%;">Id</th>\n              <th style="min-width: 200px; width: 80%;">Password</th>\n              <th style="min-width: 200px; width: 10%;">Deleted at</th>\n            </tr>\n            ${s}\n          </table>`):r.split("%histories%").join("");const a=new Blob([r],{type:"text/html"});createElement("a",{href:URL.createObjectURL(a),target:"_blank",download:`passwords_${getDate("-")}.html`}).click()})}}let modalPasswordsExport=void 0;function initModalPasswordsExport(){modalPasswordsExport?modalPasswordsExport.init():modalPasswordsExport=new ModalPasswordsExport(contentAccountSettings.querySelector("#modal-passwords-export"),contentAccountSettings.querySelector("#modal-passwords-export .modal-header #icon-close"),contentAccountSettings.querySelector("#modal-passwords-export form"),contentAccountSettings.querySelector("#modal-passwords-export #password-container"),2,128)}class ModalMyAccountEdit{constructor(e,t,s,o,r,a){this.modal=e,this.headerTitle=t,this.headerIconClose=s,this.form=o,this.changePasswordContainer=r,this.buttonSave=a,this.register()}open(){addClassName(this.modal,"active")}close(){removeClassName(this.modal,"active")}setHeaderTitle(e){this.headerTitle.innerHTML=e}getModal(){return this.modal}register(){this.headerIconClose.onclick=(()=>removeClassName(this.modal,"active")),this.init(),this.form.checkBoxChangePassword.onclick=(()=>toggleClassName(this.changePasswordContainer,"active")),this.buttonSave.onclick=(()=>{this.form.onsubmit=(e=>{e.preventDefault(),this.save()})})}init(){this.close(),this.form.username.setAttribute("minlength",config.account.username.min),this.form.username.setAttribute("maxlength",config.account.username.max),this.form.email.setAttribute("minlength",config.account.email.min),this.form.email.setAttribute("maxlength",config.account.email.max),this.form.symbols.setAttribute("minlength",config.symbols.min),this.form.symbols.setAttribute("maxlength",config.symbols.max),this.form.oldPassword.setAttribute("minlength",config.password.password.min),this.form.oldPassword.setAttribute("maxlength",config.password.password.max),this.form.newPassword.setAttribute("minlength",config.password.password.min),this.form.newPassword.setAttribute("maxlength",config.password.password.max),this.form.confirmNewPassword.setAttribute("minlength",config.password.password.min),this.form.confirmNewPassword.setAttribute("maxlength",config.password.password.max),isAccountDataAvailable(this.form.username,myAccount.username,!0,config.account.username.min,config.account.username.max),isAccountDataAvailable(this.form.email,myAccount.email,!0,config.account.email.min,config.account.email.max),checkInputValidation(this.form.symbols,config.symbols.min,config.symbols.max);const e=getKey();this.form.oldPassword.oninput=(()=>{this.form.oldPassword.value.length>=config.password.password.min&&this.form.oldPassword.value.length<=config.password.password.max&&this.form.oldPassword.value===e?setInputIcon(this.form.oldPassword,"check"):setInputIcon(this.form.oldPassword,"cross")}),this.form.newPassword.oninput=(()=>{if(this.form.newPassword.value.length>=config.password.password.min&&this.form.newPassword.value.length<=config.password.password.max){if(this.form.newPassword.value===e)return void setInputIcon(this.form.newPassword,"cross");setInputIcon(this.form.newPassword,"check"),this.form.newPassword.value===this.form.confirmNewPassword.value?setInputIcon(this.form.confirmNewPassword,"check"):setInputIcon(this.form.confirmNewPassword,"cross")}else setInputIcon(this.form.newPassword,"cross")}),this.form.confirmNewPassword.oninput=(()=>{if(this.form.confirmNewPassword.value.length>=config.password.password.min&&this.form.confirmNewPassword.value.length<=config.password.password.max){if(this.form.confirmNewPassword.value===e)return void setInputIcon(this.form.confirmNewPassword,"cross");this.form.newPassword.value===this.form.confirmNewPassword.value?setInputIcon(this.form.confirmNewPassword,"check"):setInputIcon(this.form.confirmNewPassword,"cross")}else setInputIcon(this.form.confirmNewPassword,"cross")})}reset(){setInputIcon(this.form.username,"none"),setInputIcon(this.form.email,"none"),setInputIcon(this.form.symbols,"none"),setInputIcon(this.form.oldPassword,"none"),setInputIcon(this.form.newPassword,"none"),setInputIcon(this.form.confirmNewPassword,"none"),this.form.username.value=myAccount.username,this.form.email.value=myAccount.email,this.form.symbols.value=myAccount.symbols,this.form.checkBoxChangePassword.checked=!1,removeClassName(this.changePasswordContainer,"active"),this.form.oldPassword.value="",this.form.oldPassword.style.boxShadow="none",this.form.newPassword.value="",this.form.newPassword.style.boxShadow="none",this.form.confirmNewPassword.value="",this.form.confirmNewPassword.style.boxShadow="none",this.form.checkBoxSendEmail.checked=!0,this.buttonSave.value="save"}build(){this.reset(),this.open()}save(){if("save"===this.buttonSave.value)return void(this.buttonSave.value="sure?");if("sure?"!==this.buttonSave.value)return;if(this.form.username.value===myAccount.username&&this.form.email.value===myAccount.email&&this.form.symbols.value===myAccount.symbols&&!1===this.form.checkBoxChangePassword.checked)return modalMyAccountEdit.close(),void sendPopup("success",config.messages.account.meUpdated);const e={type:"my",id:myAccount.id};if(this.form.checkBoxChangePassword.checked){const t=getKey();if(this.form.oldPassword.value!==t)return sendPopup("error","Old password not valid"),void setInputIcon(this.form.oldPassword,"cross");if(0===this.form.newPassword.value.length||this.form.newPassword.value===t)return sendPopup("error","new password is not valid"),setInputIcon(this.form.newPassword,"cross"),void setInputIcon(this.form.confirmNewPassword,"cross");if(0===this.form.confirmNewPassword.value.length)return sendPopup("error","confirm password is empty"),void setInputIcon(this.form.confirmNewPassword,"cross");if(this.form.newPassword.value!==this.form.confirmNewPassword.value)return void sendPopup("error","new password not equal to confirm password");e.newpassword=this.form.newPassword.value}this.checkUsername(this.form.username,myAccount.username,t=>{t?this.checkEmail(this.form.email,myAccount.email,t=>{if(t){if(this.form.username.value!==myAccount.username&&(e.username=this.form.username.value),this.form.email.value!==myAccount.email&&(e.email=this.form.email.value),0!==this.form.symbols.value.length&&this.form.symbols.value.length>=config.symbols.min&&this.form.symbols.value.length<=config.symbols.max&&this.form.symbols.value!==myAccount.symbols&&(e.symbols=this.form.symbols.value),this.form.checkBoxChangePassword.checked){const t=[];for(const e of passwordsMap){const s={id:e[1].id,name:CryptoJS.AES.encrypt(e[1].name,this.form.newPassword.value).toString(),password:CryptoJS.AES.encrypt(e[1].password,this.form.newPassword.value).toString(),histories:[],platform:""===e[1].platform?void 0:CryptoJS.AES.encrypt(e[1].platform,this.form.newPassword.value).toString(),url:""===e[1].url?void 0:CryptoJS.AES.encrypt(e[1].url,this.form.newPassword.value).toString(),username:""===e[1].username?void 0:CryptoJS.AES.encrypt(e[1].username,this.form.newPassword.value).toString(),email:""===e[1].email?void 0:CryptoJS.AES.encrypt(e[1].email,this.form.newPassword.value).toString(),description:""===e[1].description?void 0:CryptoJS.AES.encrypt(e[1].description,this.form.newPassword.value).toString(),createdAt:CryptoJS.AES.encrypt(e[1].createdAt,this.form.newPassword.value).toString(),modifiedAt:""===e[1].modifiedAt?void 0:CryptoJS.AES.encrypt(e[1].modifiedAt,this.form.newPassword.value).toString()};for(const t of e[1].histories)s.histories.push({id:t.id,password:CryptoJS.AES.encrypt(t.password,this.form.newPassword.value).toString(),deletedAt:CryptoJS.AES.encrypt(t.deletedAt,this.form.newPassword.value).toString()});t.push(s)}e.passwords=t,e.sendEmail=this.form.checkBoxSendEmail.checked}fetch("account/update",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:(this.close(),e.success?sendPopup("success",config.messages.account.meUpdated):sendPopup("success","Error"))})}else sendPopup("error",config.messages.account.emailNotAvailable.replace("%email%",this.form.email.value))}):sendPopup("error",config.messages.account.usernameNotAvailable.replace("%username%",this.form.username.value))})}checkUsername(e,t,s){if(e.value===t)return s(!0);isAccountDataAvailable(e,t,!1,config.account.username.min,config.account.username.max,e=>s(e))}checkEmail(e,t,s){if(e.value===t)return s(!0);isAccountDataAvailable(e,t,!1,config.account.email.min,config.account.email.max,e=>s(e))}}let modalMyAccountEdit=void 0;function initModalMyAccountEdit(){modalMyAccountEdit?modalMyAccountEdit.init():modalMyAccountEdit=new ModalMyAccountEdit(contentAccountSettings.querySelector("#modal-myaccount"),contentAccountSettings.querySelector("#modal-myaccount .modal-header .title"),contentAccountSettings.querySelector("#modal-myaccount .modal-header #icon-close"),contentAccountSettings.querySelector("#modal-myaccount form"),contentAccountSettings.querySelector("#modal-myaccount .change-password-container"),contentAccountSettings.querySelector("#modal-myaccount .button-save")),modalMyAccountEdit.setHeaderTitle(`${myAccount.username} <span style="color: #d1d1d1">#</span>${myAccount.id}`)}const menuIcon=document.querySelector(".menu-icon"),nav=document.querySelector(".nav"),navIconClose=document.querySelector(".nav-icon-close");menuIcon.onclick=(()=>toggleClassName(nav,"active")),navIconClose.onclick=(()=>toggleClassName(nav,"active"));const gridContainer=document.querySelector(".grid-container"),contentCreatePassword=document.querySelector(".content-createpassword"),contentPasswords=document.querySelector(".content-passwords"),contentAccountSettings=document.querySelector(".content-accountsettings"),contentServerSettings=document.querySelector(".content-serversettings"),navItemCreatePassword=document.querySelector(".nav-item-createpassword"),navItemPasswords=document.querySelector(".nav-item-passwords"),navItemAccountSettings=document.querySelector(".nav-item-accountsettings"),navItemServerSettings=document.querySelector(".nav-item-serversettings"),navItemLogOut=document.querySelector(".nav-item-logout");function changeContentTo(e){switch(e){case 0:containsClassName(navItemCreatePassword,"active")||(addClassName(navItemCreatePassword,"active"),removeClassName(navItemPasswords,"active"),removeClassName(navItemAccountSettings,"active"),removeClassName(navItemServerSettings,"active"),contentCreatePassword.style.display="block",contentPasswords.style.display="none",contentAccountSettings.style.display="none",contentServerSettings.style.display="none",removeClassName(nav,"active"),resetCreatePasswordsValues(),setCookie("user_content","0",7));break;case 1:containsClassName(navItemPasswords,"active")||(removeClassName(navItemCreatePassword,"active"),addClassName(navItemPasswords,"active"),removeClassName(navItemAccountSettings,"active"),removeClassName(navItemServerSettings,"active"),contentCreatePassword.style.display="none",contentPasswords.style.display="block",contentAccountSettings.style.display="none",contentServerSettings.style.display="none",removeClassName(nav,"active"),setCookie("user_content","1",7),passwordSearch.clearAndReload(),passwordsMap.size>0&&showNoPasswordsMessage(!1));break;case 2:containsClassName(navItemAccountSettings,"active")||(removeClassName(navItemCreatePassword,"active"),removeClassName(navItemPasswords,"active"),addClassName(navItemAccountSettings,"active"),removeClassName(navItemServerSettings,"active"),contentCreatePassword.style.display="none",contentPasswords.style.display="none",contentAccountSettings.style.display="block",contentServerSettings.style.display="none",removeClassName(nav,"active"),setCookie("user_content","2",7));break;case 3:if(clientIsAdmin){if(!containsClassName(navItemServerSettings,"active"))switch(removeClassName(navItemCreatePassword,"active"),removeClassName(navItemPasswords,"active"),removeClassName(navItemAccountSettings,"active"),addClassName(navItemServerSettings,"active"),contentCreatePassword.style.display="none",contentPasswords.style.display="none",contentAccountSettings.style.display="none",contentServerSettings.style.display="block",removeClassName(nav,"active"),setCookie("user_content","3",7),getCookie("user_content_serversettings")||changeServerSettingsContentTo(0),parseInt(getCookie("user_content_serversettings"))){case 0:removeClassName(serverSettingsTabItemAccounts,"active"),changeServerSettingsContentTo(0);break;case 1:removeClassName(serverSettingsTabItemLogs,"active"),changeServerSettingsContentTo(1)}}else navItemServerSettings.style.display="none",sendPopup("error",config.messages.noPermissions),changeContentTo(0)}}function setInputIcon(e,t){switch(t){case"loading":e.style.boxShadow="none",e.style.backgroundImage="url(/assets/img/loader.gif)";break;case"check":e.style.boxShadow="none",e.style.backgroundImage="url(/assets/img/checkGreen.svg)";break;case"cross":e.style.boxShadow="0 0 2px 2px #c0392b",e.style.backgroundImage="url(/assets/img/crossRed.svg)";break;case"none":e.style.boxShadow="none",e.style.backgroundImage="none";break;default:throw new Error("Unknown Input Icon value")}}navItemCreatePassword.onclick=(()=>changeContentTo(0)),navItemPasswords.onclick=(()=>changeContentTo(1)),navItemAccountSettings.onclick=(()=>changeContentTo(2)),navItemServerSettings.onclick=(()=>changeContentTo(3)),navItemLogOut.onclick=(()=>handleLogOut());let delay=function(){let e=0;return function(t,s){clearTimeout(e),e=setTimeout(t,s)}}();const popupContainer=document.querySelector("#popup-container");function sendPopup(e,t){const s=createElement("div",{class:`popup popup-${e}`});popupContainer.appendChild(s);const o=createElement("div",{class:"popup-message"},t,!0);function r(e){const t=setInterval(()=>{popupContainer.contains(e)?(e.style.opacity||(e.style.opacity=.8),e.style.opacity>0?e.style.opacity-=.1:(clearInterval(t),popupContainer.removeChild(e))):clearInterval(t)},30)}s.appendChild(o),s.onclick=(()=>r(s)),setTimeout(()=>{s&&r(s)},5e3)}class Slider{constructor(e,t){this.textElement=e,this.sliderElement=t,this.register()}set value(e){this.sliderElement.value=e}setText(e){this.textElement.innerText=e}get value(){return parseInt(this.sliderElement.value)}register(){this.sliderElement.oninput=(()=>this.setText(this.sliderElement.value))}}const createPasswordForm=contentCreatePassword.querySelector("form"),createPasswordSliderText=contentCreatePassword.querySelector(".slider-text"),createPasswordSlider=new Slider(createPasswordSliderText,createPasswordForm.slider);function resetCreatePasswordsValues(){createPasswordForm.name.value="",setInputIcon(createPasswordForm.name,"none"),createPasswordForm.platform.value="",setInputIcon(createPasswordForm.platform,"none"),createPasswordForm.url.value="",setInputIcon(createPasswordForm.url,"none"),createPasswordForm.username.value="",setInputIcon(createPasswordForm.username,"none"),createPasswordForm.email.value="",setInputIcon(createPasswordForm.email,"none"),createPasswordForm.description.value="",setInputIcon(createPasswordForm.description,"none"),createPasswordForm.checkBoxLetters.checked="true",createPasswordForm.checkBoxNumbers.checked="true",createPasswordForm.checkBoxSymbols.checked="true",createPasswordForm.symbols.value=localStorage.getItem("symbols"),createPasswordSlider.setText(config.password.password.default),createPasswordSlider.value=config.password.password.default,createPasswordForm.submit.value="create password"}const reg=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;function isAccountDataAvailable(e,t,s,o,r,a){function i(e,t,s,o,r){if(e.value.length>=s&&e.value.length<=o){if("email"===e.type&&!reg.test(e.value))return setInputIcon(e,"cross"),void r(!1);if(t&&e.value===t)return setInputIcon(e,"none"),void r(!1);setInputIcon(e,"loading"),r(!0)}else setInputIcon(e,"cross"),r(!1)}function n(e,t){fetch("account/check",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.value.includes("@")?`email=${e.value.toLowerCase()}`:`username=${e.value}`}).then(e=>e.json()).then(s=>{s.available?setInputIcon(e,"check"):setInputIcon(e,"cross"),t&&t(s.available)})}s?e.oninput=(()=>{i(e,t,o,r,s=>{s&&delay(function(){i(e,t,o,r,t=>{t&&n(e)})},500)})}):i(e,t,o,r,t=>{if(!t)return a(!1);n(e,e=>a(e))})}function checkInputValidation(e,t,s){e.oninput=(()=>{0==e.value.length?setInputIcon(e,"none"):"email"===e.type?0==reg.test(e.value)?setInputIcon(e,"cross"):e.value.length>=t&&e.value.length<=s?isAccountDataAvailable(e,void 0,!1,t,s):setInputIcon(e,"cross"):e.value.length>=t&&e.value.length<=s?setInputIcon(e,"check"):setInputIcon(e,"cross")})}function initCreatePassword(){createPasswordForm.name.setAttribute("minlength",config.password.name.min),createPasswordForm.name.setAttribute("maxlength",config.password.name.max),createPasswordForm.platform.setAttribute("minlength",config.password.platform.min),createPasswordForm.platform.setAttribute("maxlength",config.password.platform.max),createPasswordForm.url.setAttribute("minlength",config.password.url.min),createPasswordForm.url.setAttribute("maxlength",config.password.url.max),createPasswordForm.username.setAttribute("minlength",config.password.username.min),createPasswordForm.username.setAttribute("maxlength",config.password.username.max),createPasswordForm.email.setAttribute("minlength",config.password.email.min),createPasswordForm.email.setAttribute("maxlength",config.password.email.max),createPasswordForm.description.setAttribute("minlength",config.password.description.min),createPasswordForm.description.setAttribute("maxlength",config.password.description.max),createPasswordForm.symbols.setAttribute("minlength",config.symbols.min),createPasswordForm.symbols.setAttribute("maxlength",config.symbols.max),createPasswordForm.slider.setAttribute("min",config.password.password.min),createPasswordForm.slider.setAttribute("max",config.password.password.max),isPasswordNameAvailableEvent(createPasswordForm.name,config.password.name.min,config.password.name.max),checkInputValidation(createPasswordForm.platform,config.password.platform.min,config.password.platform.max),checkInputValidation(createPasswordForm.url,config.password.url.min,config.password.url.max),checkInputValidation(createPasswordForm.username,config.password.username.min,config.password.username.max),checkInputValidation(createPasswordForm.email,config.password.email.min,config.password.email.max),checkInputValidation(createPasswordForm.description,config.password.description.min,config.password.description.max)}createPasswordForm.onsubmit=(e=>{if(e.preventDefault(),!createPasswordForm.name.value||!createPasswordForm.name.value.replace(/\s/g,"").length||createPasswordForm.name.value.length<config.password.name.min||createPasswordForm.name.value.length>config.password.name.max)return void sendPopup("error",config.messages.password.typeNotValid.replace("%type%",createPasswordForm.name.value));if(isPasswordNameAvailable(createPasswordForm.name.value))if(0!==createPasswordForm.platform.value.length&&createPasswordForm.platform.value.length<config.password.platform.min||createPasswordForm.platform.value.length>config.password.platform.max)sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Platform"));else if(0!==createPasswordForm.url.value.length&&createPasswordForm.url.value.length<config.password.url.min||createPasswordForm.url.value.length>config.password.url.max)sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Url"));else if(0!==createPasswordForm.username.value.length&&createPasswordForm.username.value.length<config.password.username.min||createPasswordForm.username.value.length>config.password.username.max)sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Username"));else if(0!==createPasswordForm.email.value.length&&createPasswordForm.email.value.length<config.password.email.min||createPasswordForm.email.value.length>config.password.email.max)sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Email"));else if(0!==createPasswordForm.description.value.length&&createPasswordForm.description.value.length<config.password.description.min||createPasswordForm.description.value.length>config.password.description.max)sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Description"));else if(createPasswordForm.slider.value<config.password.password.min||createPasswordForm.slider.value>config.password.password.max)sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Password length"));else try{const e=getKey(),t=generatePassword({letters:createPasswordForm.checkBoxLetters.checked,numbers:createPasswordForm.checkBoxNumbers.checked,symbols:createPasswordForm.checkBoxSymbols.checked},createPasswordForm.symbols.value,createPasswordSlider.value),s={type:0,id:generateUniquePasswordId(),name:CryptoJS.AES.encrypt(createPasswordForm.name.value,e).toString(),password:CryptoJS.AES.encrypt(t,e).toString(),platform:""===createPasswordForm.platform.value?void 0:CryptoJS.AES.encrypt(createPasswordForm.platform.value,e).toString(),url:""===createPasswordForm.url.value?void 0:CryptoJS.AES.encrypt(createPasswordForm.url.value,e).toString(),username:""===createPasswordForm.username.value?void 0:CryptoJS.AES.encrypt(createPasswordForm.username.value,e).toString(),email:""===createPasswordForm.email.value?void 0:CryptoJS.AES.encrypt(createPasswordForm.email.value,e).toString(),description:""===createPasswordForm.description.value?void 0:CryptoJS.AES.encrypt(createPasswordForm.description.value,e).toString(),createdAt:CryptoJS.AES.encrypt(Date.now().toString(),e).toString()};if(passwordsMap.size>=myAccount.passwordLimit)return void sendPopup("error",config.messages.account.passwordLimitReached);fetch("password/create",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(s)}).then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:(sendPopup("success",config.messages.password.created.replace("%name%",createPasswordForm.name.value)),changeContentTo(1))}).catch(e=>console.error(e))}catch(e){return console.error(e),void sendPopup("error","Error")}else sendPopup("error",config.messages.password.nameNotAvailable.replace("%name%",createPasswordForm.name.value))});class Search{constructor(e,t,s,o){this.element=e,this.maxLength=t,this.collapsible=s,this.collapsibleBody=o,this.register()}clear(){this.element.value=""}clearAndReload(){this.clear();for(let e=0;e<this.collapsible.length;e++)this.collapsible[e].style.display="",this.collapsibleBody[e].style.display=""}setMaxLength(e){this.maxLength=e,this.element.setAttribute("maxlength",e)}register(){this.element.setAttribute("maxlength",this.maxLength),this.element.oninput=(()=>{const e=this.element.value.toLowerCase();if(""===e){for(let e=0;e<this.collapsible.length;e++)this.collapsible[e].style.display="",this.collapsibleBody[e].style.display="";return}const t=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e.substr(s,1));return t}(e);let s=!1;for(let e=0;e<this.collapsible.length;e++){let o=this.collapsible[e].textContent.toLowerCase();for(const e of t){if(!(o.indexOf(e)>-1)){s=!1;break}s=!0}s?(this.collapsible[e].style.display="",this.collapsibleBody[e].style.display=""):(this.collapsible[e].style.display="none",this.collapsibleBody[e].style.display="none")}}),this.element.nextElementSibling.onclick=(()=>this.clearAndReload())}}function createElement(e,t,s,o){let r,a,i=document.createElement(e);if(t)for(r in t)if("style"===r)for(a in t.style)i.style[a]=t.style[a];else i.setAttribute(r,t[r]);return s&&(o?i.innerHTML=s:i.innerText=s),i}let modalPasswordEdit=void 0,modalPasswordEditSlider=void 0;function initModalPasswordEdit(){modalPasswordEdit?modalPasswordEdit.init():modalPasswordEdit=new ModalPasswordEdit(contentPasswords.querySelector(".modal"),contentPasswords.querySelector(".modal-header .title"),contentPasswords.querySelector(".modal-header #icon-close"),contentPasswords.querySelector(".modal-body form"),contentPasswords.querySelector(".modal-body #icon-showpassword"),contentPasswords.querySelector(".modal-body .icon-generatenewpassword"),contentPasswords.querySelector(".modal-body .slider-text"),contentPasswords.querySelector(".modal-body .generatenewpassword-container"),contentPasswords.querySelector(".modal-body .password-histories"),contentPasswords.querySelector(".modal-body .button-delete"),contentPasswords.querySelector(".modal-body .button-save"))}class ModalPasswordEdit{constructor(e,t,s,o,r,a,i,n,c,l,d){this.modal=e,this.headerTitle=t,this.headerIconClose=s,this.form=o,this.iconShowPassword=r,this.iconGenerateNewPassword=a,this.sliderText=i,this.generateNewPasswordContainer=n,this.passwordHistories=c,this.buttonDelete=l,this.buttonSave=d,this.slider=void 0,this.register()}open(){addClassName(this.modal,"active")}close(){removeClassName(this.modal,"active")}setHeaderTitle(e){this.headerTitle.innerHTML=e}getModal(){return this.modal}register(){this.headerIconClose.onclick=(()=>removeClassName(this.modal,"active")),this.init(),this.iconGenerateNewPassword.onclick=(()=>toggleClassName(this.generateNewPasswordContainer,"active")),this.form.buttonGenerate.onclick=(()=>{this.form.password.value=generatePassword({letters:this.form.checkBoxLetters.checked,numbers:this.form.checkBoxNumbers.checked,symbols:this.form.checkBoxSymbols.checked},this.form.symbols.value,this.slider.value)}),this.iconShowPassword.onclick=(()=>{if(containsClassName(this.iconShowPassword,"fa-eye"))return this.iconShowPassword.setAttribute("class","fa fa-eye-slash"),void this.form.password.setAttribute("type","text");this.iconShowPassword.setAttribute("class","fa fa-eye"),this.form.password.setAttribute("type","password")})}init(){Password.getPassword(this.headerTitle.innerText.split(" #")[1])||this.close(),this.form.name.setAttribute("minlength",config.password.name.min),this.form.name.setAttribute("maxlength",config.password.name.max),this.form.platform.setAttribute("minlength",config.password.platform.min),this.form.platform.setAttribute("maxlength",config.password.platform.max),this.form.url.setAttribute("minlength",config.password.url.min),this.form.url.setAttribute("maxlength",config.password.url.max),this.form.username.setAttribute("minlength",config.password.username.min),this.form.username.setAttribute("maxlength",config.password.username.max),this.form.email.setAttribute("minlength",config.password.email.min),this.form.email.setAttribute("maxlength",config.password.email.max),this.form.description.setAttribute("minlength",config.password.description.min),this.form.description.setAttribute("maxlength",config.password.description.max),this.form.password.setAttribute("minlength",config.password.password.min),this.form.password.setAttribute("maxlength",config.password.password.max),this.form.slider.setAttribute("min",config.password.password.min),this.form.slider.setAttribute("max",config.password.password.max),this.slider||(this.slider=new Slider(this.sliderText,this.form.slider)),this.slider.setText(config.password.password.default),this.slider.value=config.password.password.default,checkInputValidation(this.form.platform,config.password.platform.min,config.password.platform.max),checkInputValidation(this.form.url,config.password.url.min,config.password.url.max),checkInputValidation(this.form.username,config.password.username.min,config.password.username.max),checkInputValidation(this.form.email,config.password.email.min,config.password.email.max),checkInputValidation(this.form.description,config.password.description.min,config.password.description.max)}reset(){setInputIcon(this.form.name,"none"),setInputIcon(this.form.platform,"none"),setInputIcon(this.form.url,"none"),setInputIcon(this.form.username,"none"),setInputIcon(this.form.email,"none"),setInputIcon(this.form.description,"none"),this.form.password.boxShadow="none",removeClassName(this.generateNewPasswordContainer,"active"),this.form.checkBoxLetters.checked=!0,this.form.checkBoxNumbers.checked=!0,this.form.checkBoxSymbols.checked=!0,this.form.symbols.value=localStorage.getItem("symbols"),this.slider.setText(config.password.password.default),this.slider.value=config.password.password.default,this.iconShowPassword.setAttribute("class","fa fa-eye"),this.form.password.setAttribute("type","password");const e=this.passwordHistories.querySelectorAll(".password-history");for(const t of e)t.remove();this.buttonDelete.value="delete",this.buttonSave.value="save"}build(e){if(this.reset(),this.setHeaderTitle(`${e.name} <span style="color: #d1d1d1">#</span>${e.id}`),this.form.name.oninput=(()=>{if(this.form.name.value===e.name)return void setInputIcon(this.form.name,"none");const t=isPasswordNameAvailable(this.form.name.value);this.form.name.value!==e.name?!t||!this.form.name.value.replace(/\s/g,"").length||this.form.name.value.length<config.password.name.min||this.form.name.value.length>config.password.name.max?setInputIcon(this.form.name,"cross"):setInputIcon(this.form.name,"check"):setInputIcon(this.form.name,"none")}),void 0===e.name?this.form.name.value="":this.form.name.value=e.name,void 0===e.platform?this.form.platform.value="":this.form.platform.value=e.platform,void 0===e.url?this.form.url.value="":this.form.url.value=e.url,void 0===e.username?this.form.username.value="":this.form.username.value=e.username,void 0===e.email?this.form.email.value="":this.form.email.value=e.email,void 0===e.description?this.form.description.value="":this.form.description.value=e.description,void 0===e.password?this.form.password.value="":this.form.password.value=e.password,this.form.description.style.height="40px",0!=e.histories.length){addClassName(this.passwordHistories,"active");for(const t of e.histories){const e=createElement("div",{class:"password-history"});this.passwordHistories.appendChild(e);const s=createElement("div",{class:"popup"});e.appendChild(s);const o=createElement("p",{class:"popup-text"},`<b>Password from:</b> <br> <span style="color: ${config.colors.deletedAt}">${getFullTime(t.deletedAt)}</span>`,!0);s.appendChild(o);const r=document.createElement("p");s.appendChild(r);const a=createElement("span",{id:`password-${t.id}`},"");r.appendChild(a),a.onmouseover=(()=>o.style.visibility="visible"),a.onmouseleave=(()=>o.style.visibility="hidden");const i=document.createElement("div");e.appendChild(i);const n=createElement("i",{id:`password-show-${t.id}`,class:"fa fa-eye","aria-hidden":"true"});i.appendChild(n),n.onclick=(()=>{containsClassName(n,"fa-eye")?(removeClassName(n,"fa-eye"),addClassName(n,"fa-eye-slash"),a.innerText=t.password):(removeClassName(n,"fa-eye-slash"),addClassName(n,"fa-eye"),a.innerText="")});const c=createElement("i",{id:`password-trash-${t.id}`,class:"fa fa-trash","aria-hidden":"true"});i.appendChild(c),c.onclick=(()=>containsClassName(c,"delete")?removeClassName(c,"delete"):addClassName(c,"delete"))}}else removeClassName(this.passwordHistories,"active");this.buttonDelete.onclick=(()=>{this.form.onsubmit=(t=>{t.preventDefault(),this.delete(e)})}),this.buttonSave.onclick=(()=>{this.form.onsubmit=(t=>{t.preventDefault(),this.save(e)})}),this.open()}delete(e){"delete"!==this.buttonDelete.value?"sure?"===this.buttonDelete.value&&(modalPasswordEdit.close(),fetch("password/delete",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({passwordId:e.id,deletedAt:CryptoJS.AES.encrypt(Date.now().toString(),getKey()).toString()})}).then(e=>e.json()).then(t=>{t.logout?window.location.href=t.logout:(0===passwordsMap.size&&showNoPasswordsMessage(!0),sendPopup("success",config.messages.password.deleted.replace("%name%",e.name)))})):this.buttonDelete.value="sure?"}save(e){if("save"!==this.buttonSave.value){if("sure?"===this.buttonSave.value){let t=!0;if(this.form.name.value===e.name&&this.form.platform.value==e.platform&&this.form.url.value===e.url&&this.form.username.value===e.username&&this.form.email.value===e.email&&this.form.description.value===e.description&&this.form.password.value===e.password){t=void 0!==e.histories.find(e=>containsClassName(contentPasswords.querySelector(`#password-trash-${e.id}`),"delete"))}if(!t)return modalPasswordEdit.close(),void sendPopup("success",config.messages.password.updated.replace("%name%",this.form.name.value));if(this.form.name.value!==e.name){if(!this.form.name.value||!this.form.name.value.replace(/\s/g,"").length||this.form.name.value.length<config.password.name.min||this.form.name.value.length>config.password.name.max)return void sendPopup("error",config.messages.password.typeNotValid.replace("%type%",this.form.name.value));if(!isPasswordNameAvailable(this.form.name.value))return void sendPopup("error",config.messages.password.nameNotAvailable.replace("%name%",this.form.name.value))}if(0!==this.form.platform.value.length&&this.form.platform.value.length<config.password.platform.min||this.form.platform.value.length>config.password.platform.max)return void sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Platform"));if(0!==this.form.url.value.length&&this.form.url.value.length<config.password.url.min||this.form.url.value.length>config.password.url.max)return void sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Url"));if(0!==this.form.username.value.length&&this.form.username.value.length<config.password.username.min||this.form.username.value.length>config.password.username.max)return void sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Username"));if(0!==this.form.email.value.length&&this.form.email.value.length<config.password.email.min||this.form.email.value.length>config.password.email.max)return void sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Email"));if(0!==this.form.description.value.length&&this.form.description.value.length<config.password.description.min||this.form.description.value.length>config.password.description.max)return void sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Description"));if(0!==this.form.password.value.length&&this.form.password.value.length<config.password.password.min||this.form.password.value.length>config.password.password.max)return void sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Password"));if(this.form.slider.value<config.password.password.min||this.form.slider.value>config.password.password.max)return void sendPopup("error",config.messages.password.typeNotValid.replace("%type%","Password length"));const s=getKey(),o=Date.now().toString(),r={id:e.id,histories:e.histories,name:""===this.form.name.value?void 0:CryptoJS.AES.encrypt(this.form.name.value,s).toString(),platform:""===this.form.platform.value?void 0:CryptoJS.AES.encrypt(this.form.platform.value,s).toString(),url:""===this.form.url.value?void 0:CryptoJS.AES.encrypt(this.form.url.value,s).toString(),username:""===this.form.username.value?void 0:CryptoJS.AES.encrypt(this.form.username.value,s).toString(),email:""===this.form.email.value?void 0:CryptoJS.AES.encrypt(this.form.email.value,s).toString(),description:""===this.form.description.value?void 0:CryptoJS.AES.encrypt(this.form.description.value,s).toString(),modifiedAt:CryptoJS.AES.encrypt(o,s).toString()};for(const e of r.histories){containsClassName(contentPasswords.querySelector(`#password-trash-${e.id}`),"delete")&&(r.histories=r.histories.filter(t=>t.id!=e.id))}if(e.password!==this.form.password.value){const t={id:generateUniqueHistoryId(),password:e.password,deletedAt:o};r.password=CryptoJS.AES.encrypt(this.form.password.value,s).toString(),r.histories.push(t)}else r.password=CryptoJS.AES.encrypt(e.password,s).toString();const a=[];for(const e of r.histories){const t={id:e.id,password:CryptoJS.AES.encrypt(e.password,s).toString(),deletedAt:CryptoJS.AES.encrypt(e.deletedAt,s).toString()};a.push(t)}r.histories=a,modalPasswordEdit.close(),fetch("password/update",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(r)}).then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:sendPopup("success",config.messages.password.updated.replace("%name%",this.form.name.value))}).catch(e=>console.error(e))}}else this.buttonSave.value="sure?"}}let passwordSearch=void 0;function initPasswordSearch(){passwordSearch?passwordSearch.setMaxLength(config.password.name.max):passwordSearch=new Search(contentPasswords.querySelector("#search-password"),config.password.name.max,contentPasswords.getElementsByClassName("collapsible"),contentPasswords.getElementsByClassName("collapsible-body"))}let passwordsMap=new Map;function generatePassword(e,t,s){let o="";e.letters&&(o+="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"),e.numbers&&(o+="0123456789"),e.symbols&&(o+=t),e.letters||e.numbers||e.symbols||(o+="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123457890");let r="";for(let e=0;e<s;e++)r+=o[Math.floor(Math.random()*o.length)];return r}function generateUniquePasswordId(){const e="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789";let t=!1,s=8;for(;!t;){let o="";for(let t=0;t<s;t++)o+=e[Math.floor(Math.random()*e.length)];if(isPasswordIdAvailable(t))return t=!0,o;s++}}function generateUniqueHistoryId(){const e="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789";let t=!1,s=8;for(;!t;){let o="";for(let t=0;t<s;t++)o+=e[Math.floor(Math.random()*e.length)];if(isHistoryIdAvailable(t))return t=!0,o;s++}}function isPasswordNameAvailableEvent(e,t,s){e.oninput=(()=>{if(setInputIcon(e,"loading"),e.value&&e.value.length>=t&&e.value.length<=s)if(0===passwordsMap.size)setInputIcon(e,"check");else for(const t of passwordsMap){if(t[1].name===e.value)return void setInputIcon(e,"cross");setInputIcon(e,"check")}else setInputIcon(e,"cross")})}function isPasswordNameAvailable(e){for(const t of passwordsMap)if(t[1].name===e)return!1;return!0}function isPasswordIdAvailable(e){for(const t of passwordsMap)if(t[1].id===e)return!1;return!0}function isHistoryIdAvailable(e){for(const t of passwordsMap)for(const s of t[1].histories)if(s.id===e)return!1;return!0}function copyToClipboard(e,t){let s=document.createElement("textarea");document.body.appendChild(s),s.value=e,s.select(),document.execCommand("copy"),document.body.removeChild(s),sendPopup("success","Copied")}let lastOpenCollapsible=void 0;class Password{constructor(e){this.id=e.id,this.name=e.name,this.password=e.password,this.histories=e.histories,this.platform=e.platform,this.url=e.url,this.username=e.username,this.email=e.email,this.description=e.description,this.createdAt=e.createdAt,this.modifiedAt=e.modifiedAt,passwordsMap.set(this.id,this),this.build()}build(){const e=createElement("button",{class:"collapsible","data-id":this.id});contentPasswords.appendChild(e),e.appendChild(createElement("p",{"data-name-id":this.id},this.name));const t=createElement("i",{class:"fa fa-cog","aria-hidden":"true"});e.appendChild(t),t.onclick=(()=>modalPasswordEdit.build(this));const s=createElement("div",{class:"collapsible-body"});contentPasswords.appendChild(s),this.buildPassword(s),this.buildHistories(s),this.buildPlatform(s),this.buildUrl(s),this.buildUsername(s),this.buildEmail(s),this.buildDescription(s),this.buildCreatedAt(s),this.buildModifiedAt(s)}buildPassword(e){e.appendChild(createElement("h4",{},"Password:"));const t=createElement("div",{class:"space-between"});e.appendChild(t);const s=createElement("p",{"data-password-id":this.id},"");t.appendChild(s);const o=document.createElement("div");t.appendChild(o);const r=createElement("i",{id:`password-show-${this.id}`,class:"fa fa-eye","aria-hidden":"true"});o.appendChild(r),r.onclick=(()=>{containsClassName(r,"fa-eye")?(removeClassName(r,"fa-eye"),addClassName(r,"fa-eye-slash"),s.innerText=this.password,this.setCollapsibleBodyHeight()):(removeClassName(r,"fa-eye-slash"),addClassName(r,"fa-eye"),s.innerText="")});const a=createElement("i",{class:"far fa-copy","aria-hidden":"true"});o.appendChild(a),a.onclick=(()=>copyToClipboard(this.password,!0))}buildHistories(e){const t=createElement("div",{id:`show-history-${this.id}`,class:"content-show"});0!==this.histories.length&&addClassName(t,"active"),e.appendChild(t),t.appendChild(createElement("h4",{},"Password histories:"));for(const e of this.histories)this.buildHistory(t,e)}buildHistory(e,t){const s=createElement("div",{id:`password-history-${t.id}`,class:"password-history"});e.appendChild(s);const o=createElement("div",{class:"popup"});s.appendChild(o);const r=createElement("p",{class:"popup-text"},`<b>Password from:</b> \n <span style="color: ${config.colors.deletedAt}">${getFullTime(t.deletedAt)}</span>`,!0);o.appendChild(r);const a=document.createElement("p");o.appendChild(a);const i=createElement("span",{"data-history-id":t.id},"");a.appendChild(i),i.onmouseover=(()=>r.style.visibility="visible"),i.onmouseleave=(()=>r.style.visibility="hidden");const n=document.createElement("div");s.appendChild(n);const c=createElement("i",{id:`history-show-${t.id}`,class:"fa fa-eye","aria-hidden":"true"});n.appendChild(c),c.onclick=(()=>{containsClassName(c,"fa-eye")?(removeClassName(c,"fa-eye"),addClassName(c,"fa-eye-slash"),i.innerText=t.password,this.setCollapsibleBodyHeight()):(removeClassName(c,"fa-eye-slash"),addClassName(c,"fa-eye"),i.innerText="")});const l=createElement("i",{class:"far fa-copy","aria-hidden":"true"});n.appendChild(l),l.onclick=(()=>copyToClipboard(t.password,!0))}buildPlatform(e){const t=createElement("div",{id:`show-platform-${this.id}`,class:"content-show"});this.platform&&addClassName(t,"active"),e.appendChild(t),t.appendChild(createElement("h4",{},"Platform:"));const s=createElement("div",{class:"space-between"});t.appendChild(s),s.appendChild(createElement("p",{"data-platform-id":this.id},this.platform));const o=createElement("i",{class:"far fa-copy","aria-hidden":"true"});s.appendChild(o),o.onclick=(()=>copyToClipboard(this.platform,!0))}buildUrl(e){const t=createElement("div",{id:`show-url-${this.id}`,class:"content-show"});this.url&&addClassName(t,"active"),e.appendChild(t),t.appendChild(createElement("h4",{},"Url:"));const s=createElement("div",{class:"space-between"});t.appendChild(s),s.appendChild(createElement("a",{"data-url-id":this.id,href:formatUrl(this.url),target:"_blank"},this.url));const o=createElement("i",{class:"far fa-copy","aria-hidden":"true"});s.appendChild(o),o.onclick=(()=>copyToClipboard(this.url,!0))}buildUsername(e){const t=createElement("div",{id:`show-username-${this.id}`,class:"content-show"});this.username&&addClassName(t,"active"),e.appendChild(t),t.appendChild(createElement("h4",{},"Username:"));const s=createElement("div",{class:"space-between"});t.appendChild(s),s.appendChild(createElement("p",{"data-username-id":this.id},this.username));const o=createElement("i",{class:"far fa-copy","aria-hidden":"true"});s.appendChild(o),o.onclick=(()=>copyToClipboard(this.username,!0))}buildEmail(e){const t=createElement("div",{id:`show-email-${this.id}`,class:"content-show"});this.email&&addClassName(t,"active"),e.appendChild(t),t.appendChild(createElement("h4",{},"Email:"));const s=createElement("div",{class:"space-between"});t.appendChild(s),s.appendChild(createElement("p",{"data-email-id":this.id},this.email));const o=createElement("i",{class:"far fa-copy","aria-hidden":"true"});s.appendChild(o),o.onclick=(()=>copyToClipboard(this.email,!0))}buildDescription(e){const t=createElement("div",{id:`show-description-${this.id}`,class:"content-show"});this.description&&addClassName(t,"active"),e.appendChild(t),t.appendChild(createElement("h4",{},"Description:")),t.appendChild(createElement("p",{"data-description-id":this.id},this.description))}buildCreatedAt(e){const t=createElement("div",{id:`show-createdat-${this.id}`,class:"content-show"});this.createdAt&&addClassName(t,"active"),e.appendChild(t),t.appendChild(createElement("h4",{},"Created at:")),t.appendChild(createElement("p",{style:{color:config.colors.createdAt}},getFullTime(this.createdAt)))}buildModifiedAt(e){const t=createElement("div",{id:`show-modifiedat-${this.id}`,class:"content-show"});this.modifiedAt&&addClassName(t,"active"),e.appendChild(t),t.appendChild(createElement("h4",{},"Modified at:")),t.appendChild(createElement("p",{"data-modifiedat-id":this.id,style:{color:config.colors.modifiedAt}},getFullTime(this.modifiedAt)))}static getPassword(e){return passwordsMap.get(e)}getId(){return this.id}show(e,t){const s=contentPasswords.querySelector(`#show-${e}-${this.id}`);!0===t?addClassName(s,"active"):removeClassName(s,"active")}setCollapsibleBodyHeight(){const e=contentPasswords.querySelector(`[data-id="${this.id}"]`);if(containsClassName(e,"active")){const t=e.nextElementSibling;t.style.maxHeight=t.scrollHeight+"px"}}setName(e){this.name=e,contentPasswords.querySelector(`[data-name-id="${this.id}"]`).innerText=e}getName(){return this.name}setPassword(e){this.password=e;const t=contentPasswords.querySelector(`[data-password-id="${this.id}"]`);""!==t.innerText&&(t.innerText=e)}getPassword(){return this.password}getHistories(){return this.histories}addHistory(e){this.histories.find(({id:t})=>t===e.id)||this.histories.push(e),this.buildHistory(contentPasswords.querySelector(`#show-history-${this.id}`),e)}removeHistory(e){this.histories=this.histories.filter(t=>t.id!=e);const t=contentPasswords.querySelector(`#password-history-${e}`);t&&t.remove()}clearHistory(){this.histories=[]}setPlatform(e){this.platform=e,contentPasswords.querySelector(`[data-platform-id="${this.id}"]`).innerText=e}getPlatform(){return this.password}setUrl(e){this.url=e;const t=contentPasswords.querySelector(`[data-url-id="${this.id}"]`);t.innerText=e,t.setAttribute("href",formatUrl(e))}getUrl(){return this.url}setUsername(e){this.username=e,contentPasswords.querySelector(`[data-username-id="${this.id}"]`).innerText=e}getUsername(){return this.username}setEmail(e){this.email=e,contentPasswords.querySelector(`[data-email-id="${this.id}"]`).innerText=e}getEmail(){return this.email}setDescription(e){this.description=e,contentPasswords.querySelector(`[data-description-id="${this.id}"]`).innerText=e}getDescription(){return this.description}setModifiedAt(e){this.modifiedAt=e,contentPasswords.querySelector(`[data-modifiedat-id="${this.id}"]`).innerHTML=getFullTime(e)}getModifiedAt(){return this.modifiedAt}static deletePassword(e){const t=contentPasswords.querySelector(`[data-id="${e}"]`),s=t.nextElementSibling;t.remove(),s.remove(),passwordsMap.delete(e)}static registerClickEvents(){const e=contentPasswords.querySelectorAll(".collapsible");for(const t of e)t.onclick=function(){if(lastOpenCollapsible&&lastOpenCollapsible!=this){const e=lastOpenCollapsible.nextElementSibling;if(e){removeClassName(lastOpenCollapsible,"active"),e.style.maxHeight=null;const t=lastOpenCollapsible.dataset.id,s=contentPasswords.querySelector(`[data-password-id="${t}"`);""!=s.innerText&&(s.innerText="");const o=contentPasswords.querySelector(`#password-show-${t}`);containsClassName(o,"fa fa-eye")||o.setAttribute("class","fa fa-eye");const r=Password.getPassword(t).histories;for(const e of r){const t=contentPasswords.querySelector(`[data-history-id="${e.id}"`);if(!t)return;""!=t.innerText&&(t.innerText="");const s=contentPasswords.querySelector(`#history-show-${e.id}`);containsClassName(s,"fa fa-eye")||s.setAttribute("class","fa fa-eye")}}}lastOpenCollapsible=this;const e=this.nextElementSibling;containsClassName(modalPasswordEdit.getModal(),"active")?(addClassName(this,"active"),e.style.maxHeight=e.scrollHeight+"px"):(toggleClassName(this,"active"),e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px")}}static clearPasswords(){passwordsMap.clear();const e=contentPasswords.querySelectorAll(".collapsible");for(const t of e)t.nextElementSibling.remove(),t.remove()}}const serverSettingsTabItemAccounts=contentServerSettings.querySelector(".tab-item-accounts"),serverSettingsTabItemLogs=contentServerSettings.querySelector(".tab-item-logs"),serverSettingsTabContentAccounts=contentServerSettings.querySelector(".tab-content-accounts"),serverSettingsTabContentLogs=contentServerSettings.querySelector(".tab-content-logs");function changeServerSettingsContentTo(e){switch(e){case 0:containsClassName(serverSettingsTabItemAccounts,"active")||(addClassName(serverSettingsTabItemAccounts,"active"),removeClassName(serverSettingsTabItemLogs,"active"),serverSettingsTabContentAccounts.style.display="block",serverSettingsTabContentLogs.style.display="none",setCookie("user_content_serversettings","0",7));break;case 1:containsClassName(serverSettingsTabItemLogs,"active")||(removeClassName(serverSettingsTabItemAccounts,"active"),addClassName(serverSettingsTabItemLogs,"active"),serverSettingsTabContentAccounts.style.display="none",serverSettingsTabContentLogs.style.display="block",setCookie("user_content_serversettings","1",7),handleServerSettingsLogs());break;default:throw new Error("Unknown Server Settings content")}}serverSettingsTabItemAccounts.onclick=(()=>changeServerSettingsContentTo(0)),serverSettingsTabItemLogs.onclick=(()=>changeServerSettingsContentTo(1));class ModalAccountCreate{constructor(e,t,s,o,r,a,i,n){this.modal=e,this.headerTitle=t,this.headerIconClose=s,this.form=o,this.generateNewPasswordContainer=r,this.sliderPasswordLengthText=a,this.sliderPasswordLength=void 0,this.sliderPasswordsLimitText=i,this.sliderPasswordsLimit=void 0,this.buttonCreate=n,this.register()}open(){addClassName(this.modal,"active")}close(){removeClassName(this.modal,"active")}setHeaderTitle(e){this.headerTitle.innerHTML=e}getModal(){return this.modal}register(){this.headerIconClose.onclick=(()=>removeClassName(this.modal,"active")),this.init(),this.form.checkBoxGeneratePassword.onclick=(()=>toggleClassName(this.generateNewPasswordContainer,"active")),this.form.buttonGenerate.onclick=(()=>{this.form.generatedPassword.value=generatePassword({letters:this.form.checkBoxLetters.checked,numbers:this.form.checkBoxNumbers.checked,symbols:this.form.checkBoxSymbols.checked},this.form.symbols.value,this.sliderPasswordLength.value)}),this.buttonCreate.onclick=(()=>{this.form.onsubmit=(e=>{e.preventDefault(),this.create()})})}init(){this.close(),this.form.username.setAttribute("minlength",config.account.username.min),this.form.username.setAttribute("maxlength",config.account.username.max),this.form.email.setAttribute("minlength",config.account.email.min),this.form.email.setAttribute("maxlength",config.account.email.max),void 0===this.sliderPasswordLength&&(this.sliderPasswordLength=new Slider(this.sliderPasswordLengthText,this.form.sliderPasswordLength)),void 0===this.sliderPasswordsLimit&&(this.sliderPasswordsLimit=new Slider(this.sliderPasswordsLimitText,this.form.sliderPasswordsLimit)),this.form.sliderPasswordLength.setAttribute("min",config.account.password.min),this.form.sliderPasswordLength.setAttribute("max",config.account.password.max),this.form.sliderPasswordsLimit.setAttribute("min",1),this.form.sliderPasswordsLimit.setAttribute("max",config.account.password.limit),isAccountDataAvailable(this.form.username,void 0,!0,config.account.username.min,config.account.username.max),isAccountDataAvailable(this.form.email,void 0,!0,config.account.email.min,config.account.email.max)}reset(){setInputIcon(this.form.username,"none"),setInputIcon(this.form.email,"none"),this.form.username.value="",this.form.email.value="",this.form.rank.value="user",this.form.checkBoxGeneratePassword.checked=!0,this.form.checkBoxSendEmail.checked=!0,removeClassName(this.generateNewPasswordContainer,"active"),this.form.checkBoxLetters.checked=!0,this.form.checkBoxNumbers.checked=!0,this.form.checkBoxSymbols.checked=!0,this.form.symbols.value=localStorage.getItem("symbols"),this.sliderPasswordLength.setText(config.account.password.default),this.sliderPasswordLength.value=config.account.password.default,this.sliderPasswordsLimit.setText(config.account.password.limit),this.sliderPasswordsLimit.value=config.account.password.limit,this.buttonCreate.value="create account"}build(){this.reset(),this.open(),this.form.generatedPassword.value=generatePassword({letters:this.form.checkBoxLetters.checked,numbers:this.form.checkBoxNumbers.checked,symbols:this.form.checkBoxSymbols.checked},this.form.symbols.value,this.sliderPasswordLength.value)}create(){"create account"!==this.buttonCreate.value?isAccountDataAvailable(this.form.username,void 0,!1,config.account.username.min,config.account.username.max,e=>{if(e)return 0==reg.test(this.form.email.value)?(setInputIcon(this.form.email,"cross"),void sendPopup("error",config.messages.account.emailNotValid.replace("%email%",this.form.email.value))):void isAccountDataAvailable(this.form.email,void 0,!1,config.account.email.min,config.account.email.max,e=>{if(e){if("sure?"===this.buttonCreate.value){let e=`username=${this.form.username.value}&email=${this.form.email.value}&permissionsLevel=${getPermissionsLevel(this.form.rank.value)}`;this.form.checkBoxGeneratePassword.checked||(e+=`&password=${this.form.generatedPassword.value}`),this.form.checkBoxSendEmail.checked&&(e+="&sendEmail=true"),this.sliderPasswordsLimit.value>0&&this.sliderPasswordsLimit.value<=config.account.password.limit?e+=`&passwordLimit=${this.sliderPasswordsLimit.value}`:e+=`&passwordLimit=${config.account.password.limit}`,fetch("account/create",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e}).then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:(this.close(),e.success?sendPopup("success",config.messages.account.created.replace("%username%",this.form.username.value)):sendPopup("success","Error"))})}}else sendPopup("error",config.messages.account.emailNotAvailable.replace("%email%",this.form.email.value))});sendPopup("error",config.messages.account.usernameNotAvailable.replace("%username%",this.form.username.value))}):this.buttonCreate.value="sure?"}}function formatUrl(e){return e.includes("http")||e.includes("https")?e:`https://${e}`}let modalAccountCreate=void 0;function initModalAccountCreate(){modalAccountCreate?modalAccountCreate.init():modalAccountCreate=new ModalAccountCreate(serverSettingsTabContentAccounts.querySelector("#modal-account-create"),serverSettingsTabContentAccounts.querySelector("#modal-account-create .modal-header .title"),serverSettingsTabContentAccounts.querySelector("#modal-account-create .modal-header #icon-close"),serverSettingsTabContentAccounts.querySelector("#modal-account-create form"),serverSettingsTabContentAccounts.querySelector("#modal-account-create .generatenewpassword-container"),serverSettingsTabContentAccounts.querySelector("#modal-account-create #slider-text-passwordlength"),serverSettingsTabContentAccounts.querySelector("#modal-account-create #slider-text-passwordlimit"),serverSettingsTabContentAccounts.querySelector("#modal-account-create .button-create"))}serverSettingsTabContentAccounts.querySelector("#create-account").onclick=(()=>modalAccountCreate.build());class ModalAccountLog{constructor(e,t,s,o,r,a,i){this.modal=e,this.headerTitle=t,this.headerIconClose=s,this.loader=o,this.ul=r,this.buttonLast=a,this.buttonNext=i,this.logEnd=!1,this.dates=null,this.dateIndex=0,this.line=0,this.register()}getModal(){return this.modal}open(){addClassName(this.modal,"active")}close(){removeClassName(this.modal,"active"),this.clearList()}setHeaderTitle(e){this.headerTitle.innerHTML=e}getHeaderTitle(){return this.headerTitle}clearList(){this.ul.innerHTML=""}setLoader(e){e?addClassName(this.loader,"active"):removeClassName(this.loader,"active")}setMouseLoader(e){document.body.style.cursor=e?"progress":"auto"}setDates(e){this.dates=e}setButton(e,t){t?(e.style.background=config.colors.buttonLastAndNext,e.style.cursor="pointer"):(e.style.background=config.colors.red,e.style.cursor="not-allowed")}register(){this.headerIconClose.onclick=(()=>removeClassName(this.modal,"active")),this.ul.onscroll=(e=>{const t=Math.round(this.ul.scrollTop),s=e.target.scrollHeight-e.target.clientHeight;if(t===s||t+1===s){if(this.logEnd)return;this.line+=500,this.setMouseLoader(!0);const e=this.getHeaderTitle().innerText.split(" ")[1].replace("#","");fetch("server/log",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=account&accountId=${e}&date=${this.dates[this.dateIndex]}&line=${this.line}`}).then(e=>e.json()).then(e=>{if(e.logout)window.location.href=e.logout;else if(this.setMouseLoader(!1),!1!==e.success)for(let t of e.messages){if("end"===t){this.logEnd=!0;break}{const e=createElement("li",{},t);this.ul.appendChild(e)}}else{const e=createElement("li",{},`<span style="color: ${config.colors.red}; font-weight: bold">Log does not exist ...</span>`);this.ul.appendChild(e)}}).catch(e=>console.error(e))}}),this.buttonLast.onclick=(()=>{if(0===this.dateIndex)return;const e=this.getHeaderTitle().innerText.split(" ")[1].replace("#","");this.dateIndex--,this.loadLog(e,this.dates[this.dateIndex]),this.setButton(this.buttonNext,!0),0===this.dateIndex&&this.setButton(this.buttonLast,!1)}),this.buttonNext.onclick=(()=>{if(this.dateIndex>=this.dates.length-1)return;const e=this.getHeaderTitle().innerText.split(" ")[1].replace("#","");this.dateIndex++,this.loadLog(e,this.dates[this.dateIndex]),this.setButton(this.buttonLast,!0),this.dateIndex>=this.dates.length-1&&this.setButton(this.buttonNext,!1)})}loadLog(e,t){this.setHeaderTitle(`${t} <span style="color: ${config.colors.hashtag}">#</span>${e}`),this.setLoader(!0),this.setMouseLoader(!0),this.clearList(),this.logEnd=!1,this.line=0,fetch("server/log",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`type=account&accountId=${e}&date=${t}&line=0`}).then(e=>e.json()).then(e=>{if(e.logout)window.location.href=e.logout;else if(this.setLoader(!1),this.setMouseLoader(!1),this.clearList(),!1!==e.success)for(let t of e.messages)if("end"===t)this.logEnd=!0;else{const e=createElement("li",{},t);this.ul.appendChild(e)}else{const e=createElement("li",{},`<span style="color: ${config.colors.red}; font-weight: bold">Log does not exist ...</span>`,!0);this.ul.appendChild(e)}}).catch(e=>console.error(e))}reset(){this.logEnd=!1,this.dateIndex=this.dates.length-1,this.line=0,this.dates.length>1?this.setButton(this.buttonLast,!0):this.setButton(this.buttonLast,!1)}build(e,t){this.dates=t,this.reset(),this.loadLog(e,this.dates[this.dates.length-1]),this.setButton(this.buttonNext,!1),this.open()}}const modalAccountLog=new ModalAccountLog(document.querySelector("#modal-account-log"),document.querySelector("#modal-account-log .title"),document.querySelector("#modal-account-log #icon-close"),document.querySelector("#modal-account-log .modal-loader"),document.querySelector("#modal-account-log ul"),document.querySelector("#modal-account-log .button-last"),document.querySelector("#modal-account-log .button-next"));class ModalAccountEdit{constructor(e,t,s,o,r,a,i){this.modal=e,this.headerTitle=t,this.headerIconClose=s,this.form=o,this.sliderText=r,this.sliderPasswordsLimit=void 0,this.buttonDelete=a,this.buttonSave=i,this.register()}open(){addClassName(this.modal,"active")}close(){removeClassName(this.modal,"active")}setHeaderTitle(e){this.headerTitle.innerHTML=e}getHeaderTitle(){return this.headerTitle.innerText}getModal(){return this.modal}register(){this.headerIconClose.onclick=(()=>this.close()),this.init()}init(){this.close(),this.form.username.setAttribute("minlength",config.account.username.min),this.form.username.setAttribute("maxlength",config.account.username.max),this.form.email.setAttribute("minlength",config.account.email.min),this.form.email.setAttribute("maxlength",config.account.email.max),this.form.sliderPasswordsLimit.setAttribute("min",1),this.form.sliderPasswordsLimit.setAttribute("max",config.account.password.limit),void 0===this.sliderPasswordsLimit&&(this.sliderPasswordsLimit=new Slider(this.sliderText,this.form.sliderPasswordsLimit))}reset(){setInputIcon(this.form.username,"none"),setInputIcon(this.form.email,"none"),this.form.checkBoxSendEmail.checked=!0,this.buttonDelete.value="delete",this.buttonSave.value="save"}build(e){this.reset();const t=serverSettingsTabContentAccounts.querySelector(`button[data-id="${e.id}"]`).dataset.permissionslevel;if(2==t||2!==myAccount.permissionsLevel?this.buttonDelete.style.cursor="not-allowed":this.buttonDelete.style.cursor="pointer",2==t){if("2"!==getCookie("permissions_level"))return void sendPopup("error",config.messages.noPermissions);this.form.rank.value="master",this.form.rank.disabled=!0}else if(1==t){if("2"!==getCookie("permissions_level")&&e.username!==getCookie("username"))return void sendPopup("error",config.messages.noPermissions);1==t&&e.username===getCookie("username")?this.form.rank.disabled=!0:this.form.rank.disabled=!1,this.form.rank.value="admin"}else this.form.rank.value="user",this.form.rank.disabled=!1;this.setHeaderTitle(`${serverSettingsTabContentAccounts.querySelector(`#username-${e.id}`).dataset.username} <span style="color: ${config.colors.hashtag}">#</span>${e.id}`),this.sliderPasswordsLimit.setText(e.passwordLimit),this.sliderPasswordsLimit.value=e.passwordLimit,isAccountDataAvailable(this.form.username,e.username,!0,config.account.username.min,config.account.username.max),isAccountDataAvailable(this.form.email,e.email,!0,config.account.email.min,config.account.email.max),this.form.username.value=e.username,this.form.email.value=e.email,this.form.checkBoxSendEmail.checked,this.buttonSave.onclick=(()=>{this.form.onsubmit=(t=>{t.preventDefault(),this.save(e)})}),this.buttonDelete.onclick=(()=>{this.form.onsubmit=(t=>{t.preventDefault(),this.delete(e)})}),this.open()}delete(e){if("delete"===this.buttonDelete.value)return 2!==myAccount.permissionsLevel||2==serverSettingsTabContentAccounts.querySelector(`button[data-id="${e.id}"]`).dataset.permissionslevel?(sendPopup("error",config.messages.noPermissions),void this.close()):void(this.buttonDelete.value="sure?");if("sure?"===this.buttonDelete.value){if(2!==myAccount.permissionsLevel)return sendPopup("error",config.messages.noPermissions),void this.close();let t=`accountId=${e.id}`;this.form.checkBoxSendEmail.checked&&(t+="&sendEmail=true"),this.close(),fetch("account/delete",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then(e=>e.json()).then(t=>{t.logout?window.location.href=t.logout:t.success?sendPopup("success",config.messages.account.deleted.replace("%username%",e.username)):sendPopup("success","Error")})}}isUsernameAvailable(e,t,s){e.value===t?s(!0):isAccountDataAvailable(e,t,!1,config.account.username.min,config.account.username.max,e=>{s(!!e)})}isEmailAvailable(e,t,s){"email"===e.type?e.value===t?s(!0):isAccountDataAvailable(e,t,!1,config.account.email.min,config.account.email.max,e=>{s(!!e)}):sendPopup("error","Error")}save(e){if("save"!==this.buttonSave.value)return this.form.username.value===e.username&&this.form.email.value===e.email&&getPermissionsLevel(this.form.rank.value)==e.permissionsLevel&&this.form.sliderPasswordsLimit.value==e.passwordLimit?(this.close(),void sendPopup("success",config.messages.account.updated.replace("%username%",this.form.username.value))):void(!(myAccount.id===e.id&&getPermissionsLevel(this.form.rank.value)!=myAccount.permissionsLevel||2===getPermissionsLevel(this.form.rank.value)&&myAccount.id!==e.id)?this.sliderPasswordsLimit.value<1||this.sliderPasswordsLimit.value>config.account.password.limit?sendPopup("error","Error"):this.isUsernameAvailable(this.form.username,e.username,t=>{t?this.isEmailAvailable(this.form.email,e.email,t=>{if(t){if("sure?"===this.buttonSave.value){let t=`accountId=${e.id}`;this.form.username.value!==e.username&&(t+=`&accountUsername=${this.form.username.value}`),this.form.email.value!==e.email&&(t+=`&accountEmail=${this.form.email.value}`),getPermissionsLevel(this.form.rank.value)!=e.permissionsLevel&&(t+=`&accountPermissionsLevel=${getPermissionsLevel(this.form.rank.value)}`),this.form.sliderPasswordsLimit.value!=e.passwordLimit&&(t+=`&accountPasswordsLimit=${this.form.sliderPasswordsLimit.value}`),this.form.checkBoxSendEmail.checked&&(t+="&sendEmail=true"),this.close(),fetch("account/update",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:e.success?sendPopup("success",config.messages.account.updated.replace("%username%",this.form.username.value)):sendPopup("success","Error")})}}else sendPopup("error",config.messages.account.emailNotAvailable.replace("%email%",this.form.email.value))}):sendPopup("error",config.messages.account.usernameNotAvailable.replace("%username%",this.form.username.value))}):sendPopup("error","Error"));this.buttonSave.value="sure?"}}let modalAccountEdit=void 0;function initModalAccountEdit(){modalAccountEdit?modalAccountEdit.init():modalAccountEdit=new ModalAccountEdit(serverSettingsTabContentAccounts.querySelector("#modal-account-edit"),serverSettingsTabContentAccounts.querySelector("#modal-account-edit .modal-header .title"),serverSettingsTabContentAccounts.querySelector("#modal-account-edit .modal-header #icon-close"),serverSettingsTabContentAccounts.querySelector("#modal-account-edit form"),serverSettingsTabContentAccounts.querySelector("#modal-account-edit .slider-text"),serverSettingsTabContentAccounts.querySelector("#modal-account-edit .button-delete"),serverSettingsTabContentAccounts.querySelector("#modal-account-edit .button-save"))}let accountSearch=void 0;function initAccountSearch(){accountSearch?accountSearch.setMaxLength(config.account.username.max):accountSearch=new Search(serverSettingsTabContentAccounts.querySelector("#search-account"),config.account.username.max,serverSettingsTabContentAccounts.getElementsByClassName("collapsible"),serverSettingsTabContentAccounts.getElementsByClassName("collapsible-body"))}let accountsMap=new Map,lastOpenAccountCollapsible=void 0;class ServerSettingsAccount{constructor(e){this.id=e.id,this.username=e.username,this.email=e.email,this.passwords=e.passwords,this.passwordLimit=e.passwordLimit,this.permissionsLevel=e.permissionsLevel,this.lastLogin=e.lastLogin,this.createdAt=e.createdAt,this.modifiedAt=e.modifiedAt,this.dates=e.dates,accountsMap.set(this.id,this)}static getAccount(e){return accountsMap.get(e)}setUsername(e){this.username=e}setEmail(e){this.email=e}setPermissionsLevel(e){this.permissionsLevel=e}setPasswordsLimit(e){this.passwordLimit=e}build(){let e;e=2===this.permissionsLevel?serverSettingsTabContentAccounts.querySelector(".collapsible-masters"):1===this.permissionsLevel?serverSettingsTabContentAccounts.querySelector(".collapsible-admins"):serverSettingsTabContentAccounts.querySelector(".collapsible-users");const t=createElement("button",{class:"collapsible","data-id":this.id,"data-permissionslevel":this.permissionsLevel});e.appendChild(t);const s=createElement("p",{id:`username-${this.id}`,"data-username":this.username},this.username);s.style.color=getRankColor(this.permissionsLevel),t.appendChild(s);const o=createElement("div");t.appendChild(o);const r=createElement("i",{class:"fa fa-desktop","aria-hidden":"true"});o.appendChild(r),r.onclick=(()=>this.dates&&0!==this.dates.length?modalAccountLog.build(this.id,this.dates):sendPopup("error",config.messages.noAccountLogs));const a=createElement("i",{class:"fa fa-cog","aria-hidden":"true"});o.appendChild(a),a.onclick=(()=>modalAccountEdit.build({id:this.id,username:this.username,email:this.email,passwordLimit:this.passwordLimit,permissionsLevel:this.permissionsLevel}));const i=createElement("div",{class:"collapsible-body"});if(e.appendChild(i),this.id){i.appendChild(createElement("h4",{},"ID:"));const e=createElement("div",{class:"space-between"});i.appendChild(e),e.appendChild(createElement("p",{},this.id));const t=createElement("i",{class:"far fa-copy","aria-hidden":"true"});e.appendChild(t),t.onclick=(()=>copyToClipboard(this.id,!0))}if(this.email){i.appendChild(createElement("h4",{},"Email:"));const e=createElement("div",{class:"space-between"});i.appendChild(e),e.appendChild(createElement("a",{id:`email-${this.id}`,href:`mailto:${this.email}`,"data-email":this.email},this.email));const t=createElement("i",{class:"far fa-copy","aria-hidden":"true"});e.appendChild(t),t.onclick=(()=>copyToClipboard(serverSettingsTabContentAccounts.querySelector(`#email-${this.id}`).innerHTML,!0))}i.appendChild(createElement("h4",{},"Passwords:")),i.appendChild(createElement("p",{id:`passwords-${this.id}`},`${this.passwords}`)),i.appendChild(createElement("h4",{},"Password limit:")),i.appendChild(createElement("p",{id:`passwordlimit-${this.id}`},`${this.passwordLimit}`)),i.appendChild(createElement("h4",{},"Rank:")),i.appendChild(createElement("p",{id:`permissionslevel-${this.id}`,style:{color:getRankColor(this.permissionsLevel)}},getRankName(this.permissionsLevel))),i.appendChild(createElement("h4",{},"Last login:")),i.appendChild(createElement("p",{id:`lastlogin-${this.id}`},null===this.lastLogin||void 0===this.lastLogin?"-/-":getFullTime(this.lastLogin))),i.appendChild(createElement("h4",{},"Created at:")),i.appendChild(createElement("p",{style:{color:config.colors.createdAt}},getFullTime(this.createdAt))),i.appendChild(createElement("h4",{},"Modified at:")),i.appendChild(createElement("p",{id:`modifiedat-${this.id}`,style:{color:config.colors.modifiedAt}},null===this.modifiedAt||void 0===this.modifiedAt?"-/-":getFullTime(this.modifiedAt)))}static registerClickEvents(){const e=serverSettingsTabContentAccounts.querySelectorAll(".collapsible");for(const t of e)t.onclick=function(){if(lastOpenAccountCollapsible&&lastOpenAccountCollapsible!=this){const e=lastOpenAccountCollapsible.nextElementSibling;e&&(removeClassName(lastOpenAccountCollapsible,"active"),e.style.maxHeight=null)}lastOpenAccountCollapsible=this;const e=this.nextElementSibling;containsClassName(modalAccountEdit.getModal(),"active")||containsClassName(modalAccountLog.getModal(),"active")?(addClassName(this,"active"),e.style.maxHeight=e.scrollHeight+"px"):(toggleClassName(this,"active"),e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px")}}}function loadAccounts(){fetch("accounts").then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:initAccounts(e.accounts)}).catch(e=>console.error(e))}class ModalLogsHistory{constructor(e,t,s,o,r,a,i){this.modal=e,this.headerTitle=t,this.headerIconClose=s,this.loader=o,this.ul=r,this.buttonLast=a,this.buttonNext=i,this.logEnd=!1,this.dates=null,this.dateIndex=0,this.line=0,this.register()}getModal(){return this.modal}open(){addClassName(this.modal,"active")}close(){removeClassName(this.modal,"active"),this.clearList()}setHeaderTitle(e){this.headerTitle.innerHTML=e}clearList(){this.ul.innerHTML=""}setLoader(e){e?addClassName(this.loader,"active"):removeClassName(this.loader,"active")}setMouseLoader(e){document.body.style.cursor=e?"progress":"auto"}setDates(e){this.dates=e}setButton(e,t){t?(e.style.background=config.colors.buttonLastAndNext,e.style.cursor="pointer"):(e.style.background=config.colors.red,e.style.cursor="not-allowed")}register(){this.headerIconClose.onclick=(()=>removeClassName(this.modal,"active")),this.ul.onscroll=(e=>{const t=Math.round(this.ul.scrollTop),s=e.target.scrollHeight-e.target.clientHeight;if(t===s||t+1===s){if(this.logEnd)return;this.line+=500,this.setMouseLoader(!0),fetch("server/log",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`date=${this.dates[this.dateIndex]}&line=${this.line}`}).then(e=>e.json()).then(e=>{if(e.logout)window.location.href=e.logout;else if(this.setMouseLoader(!1),!1!==e.success)for(let t of e.messages){if("end"===t){this.logEnd=!0;break}{const e=createElement("li",{},t);this.ul.appendChild(e)}}else{const e=createElement("li",{},`<span style="color: ${config.colors.red}; font-weight: bold">Log does not exist ...</span>`);this.ul.appendChild(e)}}).catch(e=>console.error(e))}}),this.buttonLast.onclick=(()=>{0!==this.dateIndex&&(this.dateIndex--,this.loadLog(this.dates[this.dateIndex]),this.setButton(this.buttonNext,!0),0===this.dateIndex&&this.setButton(this.buttonLast,!1))}),this.buttonNext.onclick=(()=>{this.dateIndex>=this.dates.length-1||(this.dateIndex++,this.loadLog(this.dates[this.dateIndex]),this.setButton(this.buttonLast,!0),this.dateIndex>=this.dates.length-1&&this.setButton(this.buttonNext,!1))})}loadLog(e){this.setHeaderTitle(e),this.setLoader(!0),this.setMouseLoader(!0),this.clearList(),this.logEnd=!1,this.line=0,fetch("server/log",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`date=${e}&line=0`}).then(e=>e.json()).then(e=>{if(e.logout)window.location.href=e.logout;else if(this.setLoader(!1),this.setMouseLoader(!1),this.clearList(),!1!==e.success)for(let t of e.messages)if("end"===t)this.logEnd=!0;else{const e=createElement("li",{},t);this.ul.appendChild(e)}else{const e=createElement("li",{},`<span style="color: ${config.colors.red}; font-weight: bold">Log does not exist ...</span>`);this.ul.appendChild(e)}}).catch(e=>console.error(e))}reset(){this.logEnd=!1,this.dateIndex=this.dates.length-1,this.line=0,this.dates.length>1?this.setButton(this.buttonLast,!0):this.setButton(this.buttonLast,!1)}build(){this.reset(),this.loadLog(this.dates[this.dates.length-1]),this.setButton(this.buttonNext,!1),this.open()}}function getDate(e){const t=new Date;return`${("0"+t.getDate()).slice(-2)}${e}${("0"+(t.getMonth()+1)).slice(-2)}${e}${t.getFullYear()}`}function calculateDate(e){const t=new Date;return t.setDate(t.getDate()-e),`${("0"+t.getDate()).slice(-2)}-${("0"+(t.getMonth()+1)).slice(-2)}-${t.getFullYear()}`}const modalLogsHistory=new ModalLogsHistory(serverSettingsTabContentLogs.querySelector(".modal"),serverSettingsTabContentLogs.querySelector(".modal .title"),serverSettingsTabContentLogs.querySelector(".modal #icon-close"),serverSettingsTabContentLogs.querySelector(".modal .modal-loader"),serverSettingsTabContentLogs.querySelector(".modal ul"),serverSettingsTabContentLogs.querySelector(".modal .button-last"),serverSettingsTabContentLogs.querySelector(".modal .button-next"));class ServerSettingsCardLogs{constructor(e,t,s){this.openIcon=e,this.ul=t,this.scrollButton=s,this.register()}register(){this.openIcon.onclick=(()=>modalLogsHistory.build()),this.ul.onscroll=(e=>{this.ul.scrollTop<e.target.scrollHeight-(e.target.clientHeight+10)?this.showScrollButton():this.hideScrollButton()}),this.scrollButton.onclick=(()=>{this.hideScrollButton();const e=this.ul.lastChild;e.parentNode.scrollTop=e.offsetTop})}showScrollButton(){addClassName(this.scrollButton,"active")}isScrollButtonShowing(){return containsClassName(this.scrollButton,"active")}hideScrollButton(){removeClassName(this.scrollButton,"active")}addMessage(e){this.ul.childElementCount>=500&&this.ul.removeChild(this.ul.firstChild);const t=createElement("li",{},e,!0);this.ul.appendChild(t),this.isScrollButtonShowing()||(t.parentNode.scrollTop=t.offsetTop)}clearList(){for(;this.ul.firstChild;)this.ul.removeChild(this.ul.firstChild)}}const serverSettingsCardLogs=new ServerSettingsCardLogs(serverSettingsTabContentLogs.querySelector(".fa-history"),serverSettingsTabContentLogs.querySelector(".card ul"),serverSettingsTabContentLogs.querySelector("#scroll-bottom"));function handleServerSettingsLogs(){serverSettingsCardLogs.clearList(),serverSettingsCardLogs.hideScrollButton(),fetch("server/log",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"type=dates"}).then(e=>e.json()).then(e=>{e.logout?window.location.href=e.logout:modalLogsHistory.setDates(e.dates)}).catch(e=>console.error(e))}function handleLogOut(e){setCookie("username","",0),setCookie("permissions_level","",0),setCookie("user_content","",0),setCookie("user_content_serversettings","",0),localStorage.removeItem("symbols"),localStorage.removeItem("key"),e?(setCookie("user_session","",0),window.location.href=e):fetch("logout",{method:"POST"}).then(e=>e.json()).then(e=>{setCookie("user_session","",0),window.location.href=e.logout})}function updateServerStats(e){e&&(void 0!==e.accounts&&(contentServerSettings.querySelector("#total-accounts").innerHTML=e.accounts),void 0!==e.passwords&&(contentServerSettings.querySelector("#total-passwords").innerHTML=e.passwords))}window.onclick=(e=>{containsClassName(pageLoader,"active")||(e.target===modalPasswordEdit.getModal()&&modalPasswordEdit.close(),e.target===modalAccountCreate.getModal()&&modalAccountCreate.close(),e.target===modalAccountLog.getModal()&&modalAccountLog.close(),e.target===modalAccountEdit.getModal()&&modalAccountEdit.close(),e.target===modalLogsHistory.getModal()&&modalLogsHistory.close(),e.target===modalMyAccountEdit.getModal()&&modalMyAccountEdit.close(),e.target===modalPasswordsExport.getModal()&&modalPasswordsExport.close(),e.target===modalPasswordsImport.getModal()&&modalPasswordsImport.close())}),window.onkeyup=(e=>{containsClassName(pageLoader,"active")||"Escape"===e.code&&(containsClassName(navItemPasswords,"active")&&passwordSearch.clearAndReload(),containsClassName(modalPasswordEdit.getModal(),"active")&&modalPasswordEdit.close(),containsClassName(serverSettingsTabItemAccounts,"active")&&accountSearch.clearAndReload(),containsClassName(modalAccountCreate.getModal(),"active")&&modalAccountCreate.close(),containsClassName(modalAccountLog.getModal(),"active")&&modalAccountLog.close(),containsClassName(modalAccountEdit.getModal(),"active")&&modalAccountEdit.close(),containsClassName(modalLogsHistory.getModal(),"active")&&modalLogsHistory.close(),containsClassName(modalMyAccountEdit.getModal(),"active")&&modalMyAccountEdit.close(),containsClassName(modalPasswordsExport.getModal(),"active")&&modalPasswordsExport.close(),containsClassName(modalPasswordsImport.getModal(),"active")&&modalPasswordsImport.close())});const usernameContainer=document.querySelectorAll(".username-container"),username=document.querySelectorAll(".username");function updateUser(e){if(e.username&&(setCookie("username",e.username,7),username[0].innerHTML=e.username,username[1].innerHTML=e.username,setAccount("username",e.username)),e.passwordLimit&&setAccount("passwordLimit",e.passwordLimit),null!=e.permissionsLevel){setCookie("permissions_level",e.permissionsLevel,7);const t=getRankColor(e.permissionsLevel);usernameContainer[0].style.color=t,username[0].style.color=t,usernameContainer[1].style.color=t,username[1].style.color=t,setAccount("permissionsLevel",e.permissionsLevel,t),e.permissionsLevel>0?(clientIsAdmin=!0,navItemServerSettings.style.display="block",e.loadAccounts&&loadAccounts()):(clientIsAdmin=!1,navItemServerSettings.style.display="none",3==getCookie("user_content")&&changeContentTo(0),accountsMap.clear())}e.email&&setAccount("email",e.email),e.symbols&&(setAccount("symbols",e.symbols),localStorage.setItem("symbols",e.symbols)),e.lastLogin&&setAccount("lastLogin",getFullTime(e.lastLogin)),e.modifiedAt&&setAccount("modifiedAt","-/-"===e.modifiedAt?"-/-":getFullTime(e.modifiedAt),config.colors.modifiedAt)}function getRankColor(e){const t=parseInt(e);return 2===t?config.colors.rankMaster:1===t?config.colors.rankAdmin:config.colors.rankUser}function getRankName(e){return 2==e?"Master":1==e?"Admin":"User"}function getPermissionsLevel(e){return"master"===e?2:"admin"===e?1:0}function getKey(){return CryptoJS.AES.decrypt(localStorage.getItem("key"),getCookie("user_session")).toString(CryptoJS.enc.Utf8)}let webSocket;function startWebSocket(e){(webSocket=new WebSocket(e)).onopen=(()=>{console.info("webSocket open"),setPageLoaderStatus("connected"),initSystem()}),webSocket.onerror=(e=>console.error("websocket error",e)),webSocket.onclose=(t=>{console.info("websocket closed"),t.wasClean||(setPageLoader(0),setPageLoaderStatus("reconnect ..."),setTimeout(()=>{console.warn("reconnect...."),startWebSocket(e)},2e3))}),webSocket.onmessage=(e=>{const t=JSON.parse(e.data);switch(t.type){case"logout":handleLogOut(t.location);break;case"reload":setPageLoader(0),setPageLoaderStatus("reload ..."),initSystem();break;case"updateUser":t.loadAccounts=!0,updateUser(t);break;case"addPassword":{const e=getKey(),s=t.password,o={id:s.id,name:CryptoJS.AES.decrypt(s.name,e).toString(CryptoJS.enc.Utf8),password:CryptoJS.AES.decrypt(s.password,e).toString(CryptoJS.enc.Utf8),platform:void 0===s.platform?"":CryptoJS.AES.decrypt(s.platform,e).toString(CryptoJS.enc.Utf8),url:void 0===s.url?"":CryptoJS.AES.decrypt(s.url,e).toString(CryptoJS.enc.Utf8),username:void 0===s.username?"":CryptoJS.AES.decrypt(s.username,e).toString(CryptoJS.enc.Utf8),email:void 0===s.email?"":CryptoJS.AES.decrypt(s.email,e).toString(CryptoJS.enc.Utf8),description:void 0===s.description?"":CryptoJS.AES.decrypt(s.description,e).toString(CryptoJS.enc.Utf8),createdAt:CryptoJS.AES.decrypt(s.createdAt,e).toString(CryptoJS.enc.Utf8),modifiedAt:void 0===s.modifiedAt?void 0:CryptoJS.AES.decrypt(s.modifiedAt,e).toString(CryptoJS.enc.Utf8)};if(s.histories.length>0){const t=[];for(const o of s.histories){const s={id:o.id,password:CryptoJS.AES.decrypt(o.password,e).toString(CryptoJS.enc.Utf8),deletedAt:CryptoJS.AES.decrypt(o.deletedAt,e).toString(CryptoJS.enc.Utf8)};t.push(s)}o.histories=t}else o.histories=[];0===passwordsMap.size&&showNoPasswordsMessage(!1),new Password(o),Password.registerClickEvents(),setAccount("passwords",passwordsMap.size);break}case"updatePassword":{const e=getKey(),s=t.password,o={id:s.id,name:void 0===s.name?"":CryptoJS.AES.decrypt(s.name,e).toString(CryptoJS.enc.Utf8),password:void 0===s.password?"":CryptoJS.AES.decrypt(s.password,e).toString(CryptoJS.enc.Utf8),histories:[],platform:void 0===s.platform?"":CryptoJS.AES.decrypt(s.platform,e).toString(CryptoJS.enc.Utf8),url:void 0===s.url?"":CryptoJS.AES.decrypt(s.url,e).toString(CryptoJS.enc.Utf8),username:void 0===s.username?"":CryptoJS.AES.decrypt(s.username,e).toString(CryptoJS.enc.Utf8),email:void 0===s.email?"":CryptoJS.AES.decrypt(s.email,e).toString(CryptoJS.enc.Utf8),description:void 0===s.description?"":CryptoJS.AES.decrypt(s.description,e).toString(CryptoJS.enc.Utf8),modifiedAt:void 0===s.modifiedAt?void 0:CryptoJS.AES.decrypt(s.modifiedAt,e).toString(CryptoJS.enc.Utf8)};modalPasswordEdit.headerTitle.innerText.endsWith(o.id)&&containsClassName(modalPasswordEdit.getModal(),"active")&&(modalPasswordEdit.close(),sendPopup("error",config.messages.password.updated.replace("%name%",o.name)));for(const t of s.histories){const s={id:t.id,password:CryptoJS.AES.decrypt(t.password,e).toString(CryptoJS.enc.Utf8),deletedAt:CryptoJS.AES.decrypt(t.deletedAt,e).toString(CryptoJS.enc.Utf8)};o.histories.push(s)}const r=Password.getPassword(o.id);if(o.name&&r.setName(o.name),o.password&&r.setPassword(o.password),0!==o.histories.length){for(const e of o.histories){contentPasswords.querySelector(`#password-history-${e.id}`)||(r.addHistory(e),r.show("history",!0))}const e=contentPasswords.querySelectorAll(`#show-history-${o.id} .password-history`);for(const t of e){const e=t.id.split("-")[2];if(e){o.histories.find(({id:t})=>t===e)||(r.removeHistory(e),t.remove())}}}else r.show("history",!1),r.clearHistory();o.platform?(r.show("platform",!0),r.setPlatform(o.platform)):(r.show("platform",!1),r.setPlatform("")),o.url?(r.show("url",!0),r.setUrl(o.url)):(r.show("url",!1),r.setUrl("")),o.username?(r.show("username",!0),r.setUsername(o.username)):(r.show("username",!1),r.setUsername("")),o.email?(r.show("email",!0),r.setEmail(o.email)):(r.show("email",!1),r.setEmail("")),o.description?(r.show("description",!0),r.setDescription(o.description)):(r.show("description",!1),r.setDescription("")),o.modifiedAt?(r.show("modifiedat",!0),r.setModifiedAt(o.modifiedAt)):(r.show("modifiedat",!1),r.setModifiedAt("")),r.setCollapsibleBodyHeight();break}case"deletePassword":Password.deletePassword(t.id),0===passwordsMap.size&&showNoPasswordsMessage(!0),modalPasswordEdit.headerTitle.innerText.endsWith(t.id)&&containsClassName(modalPasswordEdit.getModal(),"active")&&(modalPasswordEdit.close(),sendPopup("error",config.messages.password.deleted.replace("%name%",modalPasswordEdit.headerTitle.innerText.split(" #")[0]))),setAccount("passwords",passwordsMap.size);break;case"addAccount":new ServerSettingsAccount(t).build(),ServerSettingsAccount.registerClickEvents();break;case"updateAccount":const e=t;if(!e.id)return;const s=ServerSettingsAccount.getAccount(e.id);if(modalAccountEdit.headerTitle.innerText.endsWith(e.id)&&containsClassName(modalAccountEdit.getModal(),"active")&&(modalAccountEdit.close(),sendPopup("error",config.messages.account.updated.replace("%username%",modalAccountEdit.headerTitle.innerText.split(" #")[0]))),e.username&&(serverSettingsTabContentAccounts.querySelector(`#username-${e.id}`).innerHTML=e.username,s.setUsername(e.username)),e.email){const t=serverSettingsTabContentAccounts.querySelector(`#email-${e.id}`);t.innerHTML=e.email,t.setAttribute("href",`mailto:${e.email}`),s.setEmail(e.email)}if(null!=e.passwords&&(serverSettingsTabContentAccounts.querySelector(`#passwords-${e.id}`).innerHTML=`${e.passwords}`),e.passwordLimit&&(serverSettingsTabContentAccounts.querySelector(`#passwordlimit-${e.id}`).innerHTML=e.passwordLimit,s.setPasswordsLimit(e.passwordLimit)),e.permissionsLevel){const t=serverSettingsTabContentAccounts.querySelector(`#permissionslevel-${e.id}`);t.innerHTML=getRankName(e.permissionsLevel),t.style.color=getRankColor(e.permissionsLevel),s.setPermissionsLevel(e.permissionsLevel),serverSettingsTabContentAccounts.querySelector(`#username-${e.id}`).style.color=getRankColor(e.permissionsLevel);const o=serverSettingsTabContentAccounts.querySelector(`button[data-id="${e.id}"]`),r=o.nextElementSibling;if(o.dataset.permissionslevel=e.permissionsLevel,2==e.permissionsLevel){if("collapsible-masters"!==o.parentElement.className){const e=serverSettingsTabContentAccounts.querySelector(".collapsible-masters");e.appendChild(o),e.appendChild(r)}}else if(1==e.permissionsLevel){if("collapsible-admins"!==o.parentElement.className){const e=serverSettingsTabContentAccounts.querySelector(".collapsible-admins");e.appendChild(o),e.appendChild(r)}}else if("collapsible-users"!==o.parentElement.className){const e=serverSettingsTabContentAccounts.querySelector(".collapsible-users");e.appendChild(o),e.appendChild(r)}ServerSettingsAccount.registerClickEvents()}e.lastLogin&&(serverSettingsTabContentAccounts.querySelector(`#lastlogin-${e.id}`).innerHTML=e.lastLogin,e.id===myAccount.id&&setAccount("lastLogin",getFullTime(e.lastLogin))),e.modifiedAt&&(serverSettingsTabContentAccounts.querySelector(`#modifiedat-${e.id}`).innerHTML=getFullTime(e.modifiedAt));break;case"removeAccount":{modalAccountEdit.headerTitle.innerText.endsWith(t.id)&&containsClassName(modalAccountEdit.getModal(),"active")&&(modalAccountEdit.close(),sendPopup("error",config.messages.account.deleted.replace("%username%",modalAccountEdit.headerTitle.innerText.split(" #")[0])));const e=serverSettingsTabContentAccounts.querySelectorAll(".collapsible");for(let s of e)s.dataset.id===t.id&&(s.nextElementSibling.remove(),s.remove());break}case"updateServer":updateServerStats(t);break;case"updateLogs":containsClassName(serverSettingsTabItemLogs,"active")&&serverSettingsCardLogs.addMessage(t.message);break;case"updateSession":updateSession(t.session);break;case"removeSession":removeSession(t.id);break;case"addPasswordToTrash":addPasswordToTrash(t.password),myAccount.passwordTrash.push(t.password),handleShowPasswordTrash();break;case"deletePasswordFromTrash":deletePasswordFromTrash(t.id),handleShowPasswordTrash();break;default:throw new Error("Unknown socket message type")}})}function setCookie(e,t,s){let o=new Date;o.setTime(o.getTime()+24*s*60*60*1e3);let r="expires="+o.toUTCString();document.cookie=e+"="+t+";"+r+";path=/; Secure"}function getCookies(){let e=document.cookie,t=0,s={};return document.cookie.match(/^\s*\$Version=(?:"1"|1);\s*(.*)/)&&(e=RegExp.$1,t=1),0===t?e.split(/[,;]/).map(function(e){let t=e.split(/=/,2),o=decodeURIComponent(t[0].trimLeft()),r=t.length>1?decodeURIComponent(t[1].trimRight()):null;s[o]=r}):e.match(/(?:^|\s+)([!#$%&'*+\-.0-9A-Z^`a-z|~]+)=([!#$%&'*+\-.0-9A-Z^`a-z|~]*|"(?:[\x20-\x7E\x80\xFF]|\\[\x00-\x7F])*")(?=\s*[,;]|$)/g).map(function(e,t){let o=e,r='"'===t.charAt(0)?t.substr(1,-1).replace(/\\(.)/g,"$1"):t;s[o]=r}),s}function getCookie(e){return getCookies()[e]}setTimeout(()=>startWebSocket(webSocketServerLocation),1e3);